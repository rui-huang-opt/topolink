<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>topolink API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Graph">Graph</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Graph.__init__">Graph</a>
                        </li>
                        <li>
                                <a class="function" href="#Graph.from_mixing_matrix">from_mixing_matrix</a>
                        </li>
                        <li>
                                <a class="variable" href="#Graph.nodes">nodes</a>
                        </li>
                        <li>
                                <a class="variable" href="#Graph.edges">edges</a>
                        </li>
                        <li>
                                <a class="variable" href="#Graph.number_of_nodes">number_of_nodes</a>
                        </li>
                        <li>
                                <a class="variable" href="#Graph.number_of_edges">number_of_edges</a>
                        </li>
                        <li>
                                <a class="variable" href="#Graph.is_connected">is_connected</a>
                        </li>
                        <li>
                                <a class="function" href="#Graph.add_nodes">add_nodes</a>
                        </li>
                        <li>
                                <a class="function" href="#Graph.add_edges">add_edges</a>
                        </li>
                        <li>
                                <a class="function" href="#Graph.adjacency">adjacency</a>
                        </li>
                        <li>
                                <a class="function" href="#Graph.deploy">deploy</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#NodeHandle">NodeHandle</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#NodeHandle.__init__">NodeHandle</a>
                        </li>
                        <li>
                                <a class="variable" href="#NodeHandle.idx">idx</a>
                        </li>
                        <li>
                                <a class="variable" href="#NodeHandle.degree">degree</a>
                        </li>
                        <li>
                                <a class="variable" href="#NodeHandle.neighbors">neighbors</a>
                        </li>
                        <li>
                                <a class="variable" href="#NodeHandle.weights">weights</a>
                        </li>
                        <li>
                                <a class="function" href="#NodeHandle.close">close</a>
                        </li>
                        <li>
                                <a class="function" href="#NodeHandle.neighborwise_exchange">neighborwise_exchange</a>
                        </li>
                        <li>
                                <a class="function" href="#NodeHandle.exchange">exchange</a>
                        </li>
                        <li>
                                <a class="function" href="#NodeHandle.exchange_as_array">exchange_as_array</a>
                        </li>
                        <li>
                                <a class="function" href="#NodeHandle.laplacian">laplacian</a>
                        </li>
                        <li>
                                <a class="function" href="#NodeHandle.weighted_mix">weighted_mix</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
topolink    </h1>

                
                        <input id="mod-topolink-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-topolink-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">1</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">Graph</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">2</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.node_handle</span><span class="w"> </span><span class="kn">import</span> <span class="n">NodeHandle</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">4</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Graph&quot;</span><span class="p">,</span> <span class="s2">&quot;NodeHandle&quot;</span><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="Graph">
                            <input id="Graph-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Graph</span>:

                <label class="view-source-button" for="Graph-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Graph"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Graph-17"><a href="#Graph-17"><span class="linenos"> 17</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Graph</span><span class="p">:</span>
</span><span id="Graph-18"><a href="#Graph-18"><span class="linenos"> 18</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Graph-19"><a href="#Graph-19"><span class="linenos"> 19</span></a><span class="sd">    Represents a network topology using a NetworkX graph and provides methods for managing nodes, edges, and network deployment.</span>
</span><span id="Graph-20"><a href="#Graph-20"><span class="linenos"> 20</span></a>
</span><span id="Graph-21"><a href="#Graph-21"><span class="linenos"> 21</span></a><span class="sd">    Parameters</span>
</span><span id="Graph-22"><a href="#Graph-22"><span class="linenos"> 22</span></a><span class="sd">    ----------</span>
</span><span id="Graph-23"><a href="#Graph-23"><span class="linenos"> 23</span></a><span class="sd">    nodes : NodeInput | None, optional</span>
</span><span id="Graph-24"><a href="#Graph-24"><span class="linenos"> 24</span></a><span class="sd">        An iterable of node names to initialize the graph. If None, the graph starts empty.</span>
</span><span id="Graph-25"><a href="#Graph-25"><span class="linenos"> 25</span></a>
</span><span id="Graph-26"><a href="#Graph-26"><span class="linenos"> 26</span></a><span class="sd">    edges : EdgeInput | None, optional</span>
</span><span id="Graph-27"><a href="#Graph-27"><span class="linenos"> 27</span></a><span class="sd">        An iterable of edges (tuples of node names) to initialize the graph. If None, the graph starts with no edges.</span>
</span><span id="Graph-28"><a href="#Graph-28"><span class="linenos"> 28</span></a>
</span><span id="Graph-29"><a href="#Graph-29"><span class="linenos"> 29</span></a><span class="sd">    name : str, optional</span>
</span><span id="Graph-30"><a href="#Graph-30"><span class="linenos"> 30</span></a><span class="sd">        The name of the graph service. Default is &quot;default&quot;. When deploying multiple graphs, ensure each has a unique name.</span>
</span><span id="Graph-31"><a href="#Graph-31"><span class="linenos"> 31</span></a>
</span><span id="Graph-32"><a href="#Graph-32"><span class="linenos"> 32</span></a><span class="sd">    Attributes</span>
</span><span id="Graph-33"><a href="#Graph-33"><span class="linenos"> 33</span></a><span class="sd">    ----------</span>
</span><span id="Graph-34"><a href="#Graph-34"><span class="linenos"> 34</span></a><span class="sd">    nodes : NodeView</span>
</span><span id="Graph-35"><a href="#Graph-35"><span class="linenos"> 35</span></a><span class="sd">        A view of the nodes in the graph.</span>
</span><span id="Graph-36"><a href="#Graph-36"><span class="linenos"> 36</span></a>
</span><span id="Graph-37"><a href="#Graph-37"><span class="linenos"> 37</span></a><span class="sd">    edges : EdgeView</span>
</span><span id="Graph-38"><a href="#Graph-38"><span class="linenos"> 38</span></a><span class="sd">        A view of the edges in the graph.</span>
</span><span id="Graph-39"><a href="#Graph-39"><span class="linenos"> 39</span></a>
</span><span id="Graph-40"><a href="#Graph-40"><span class="linenos"> 40</span></a><span class="sd">    number_of_nodes : int</span>
</span><span id="Graph-41"><a href="#Graph-41"><span class="linenos"> 41</span></a><span class="sd">        The number of nodes in the graph.</span>
</span><span id="Graph-42"><a href="#Graph-42"><span class="linenos"> 42</span></a>
</span><span id="Graph-43"><a href="#Graph-43"><span class="linenos"> 43</span></a><span class="sd">    number_of_edges : int</span>
</span><span id="Graph-44"><a href="#Graph-44"><span class="linenos"> 44</span></a><span class="sd">        The number of edges in the graph.</span>
</span><span id="Graph-45"><a href="#Graph-45"><span class="linenos"> 45</span></a>
</span><span id="Graph-46"><a href="#Graph-46"><span class="linenos"> 46</span></a><span class="sd">    is_connected : bool</span>
</span><span id="Graph-47"><a href="#Graph-47"><span class="linenos"> 47</span></a><span class="sd">        Indicates whether the graph is connected.</span>
</span><span id="Graph-48"><a href="#Graph-48"><span class="linenos"> 48</span></a>
</span><span id="Graph-49"><a href="#Graph-49"><span class="linenos"> 49</span></a><span class="sd">    Notes</span>
</span><span id="Graph-50"><a href="#Graph-50"><span class="linenos"> 50</span></a><span class="sd">    -----</span>
</span><span id="Graph-51"><a href="#Graph-51"><span class="linenos"> 51</span></a><span class="sd">    - The graph must be connected before deployment.</span>
</span><span id="Graph-52"><a href="#Graph-52"><span class="linenos"> 52</span></a><span class="sd">    - The `from_mixing_matrix` method provides a convenient way to create a graph from a mixing matrix, ensuring the matrix is symmetric and double-stochastic.</span>
</span><span id="Graph-53"><a href="#Graph-53"><span class="linenos"> 53</span></a><span class="sd">    - Throughout the code, we use &#39;i&#39; to denote the current node and &#39;j&#39; to denote neighbor nodes, following common conventions in graph theory and distributed algorithms.</span>
</span><span id="Graph-54"><a href="#Graph-54"><span class="linenos"> 54</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Graph-55"><a href="#Graph-55"><span class="linenos"> 55</span></a>
</span><span id="Graph-56"><a href="#Graph-56"><span class="linenos"> 56</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Graph-57"><a href="#Graph-57"><span class="linenos"> 57</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Graph-58"><a href="#Graph-58"><span class="linenos"> 58</span></a>        <span class="n">nodes</span><span class="p">:</span> <span class="n">NodeInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Graph-59"><a href="#Graph-59"><span class="linenos"> 59</span></a>        <span class="n">edges</span><span class="p">:</span> <span class="n">EdgeInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Graph-60"><a href="#Graph-60"><span class="linenos"> 60</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="Graph-61"><a href="#Graph-61"><span class="linenos"> 61</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Graph-62"><a href="#Graph-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
</span><span id="Graph-63"><a href="#Graph-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">nodes</span> <span class="ow">or</span> <span class="p">[])</span>
</span><span id="Graph-64"><a href="#Graph-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">edges</span> <span class="ow">or</span> <span class="p">[])</span>
</span><span id="Graph-65"><a href="#Graph-65"><span class="linenos"> 65</span></a>
</span><span id="Graph-66"><a href="#Graph-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="o">=</span> <span class="n">zmq</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
</span><span id="Graph-67"><a href="#Graph-67"><span class="linenos"> 67</span></a>
</span><span id="Graph-68"><a href="#Graph-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Graph-69"><a href="#Graph-69"><span class="linenos"> 69</span></a>
</span><span id="Graph-70"><a href="#Graph-70"><span class="linenos"> 70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_advertiser</span> <span class="o">=</span> <span class="n">GraphAdvertiser</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="Graph-71"><a href="#Graph-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ip_address</span> <span class="o">=</span> <span class="n">get_local_ip</span><span class="p">()</span>
</span><span id="Graph-72"><a href="#Graph-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_router</span><span class="p">()</span>
</span><span id="Graph-73"><a href="#Graph-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_advertiser</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip_address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_port</span><span class="p">)</span>
</span><span id="Graph-74"><a href="#Graph-74"><span class="linenos"> 74</span></a>
</span><span id="Graph-75"><a href="#Graph-75"><span class="linenos"> 75</span></a>        <span class="c1"># idx: (rid: the router identity, endpoint: ip and port of the node)</span>
</span><span id="Graph-76"><a href="#Graph-76"><span class="linenos"> 76</span></a>        <span class="c1"># We do not use the node index as the ROUTER identity, so that multiple</span>
</span><span id="Graph-77"><a href="#Graph-77"><span class="linenos"> 77</span></a>        <span class="c1"># connections with the same idx can be distinguished during registration</span>
</span><span id="Graph-78"><a href="#Graph-78"><span class="linenos"> 78</span></a>        <span class="c1"># (e.g., to properly reject or replace duplicate nodes).</span>
</span><span id="Graph-79"><a href="#Graph-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_node_registry</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Graph-80"><a href="#Graph-80"><span class="linenos"> 80</span></a>
</span><span id="Graph-81"><a href="#Graph-81"><span class="linenos"> 81</span></a>    <span class="nd">@classmethod</span>
</span><span id="Graph-82"><a href="#Graph-82"><span class="linenos"> 82</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_mixing_matrix</span><span class="p">(</span>
</span><span id="Graph-83"><a href="#Graph-83"><span class="linenos"> 83</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="Graph-84"><a href="#Graph-84"><span class="linenos"> 84</span></a>        <span class="n">mixing_matrix</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
</span><span id="Graph-85"><a href="#Graph-85"><span class="linenos"> 85</span></a>        <span class="n">nodelist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Graph-86"><a href="#Graph-86"><span class="linenos"> 86</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="Graph-87"><a href="#Graph-87"><span class="linenos"> 87</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Graph&quot;</span><span class="p">:</span>
</span><span id="Graph-88"><a href="#Graph-88"><span class="linenos"> 88</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Graph-89"><a href="#Graph-89"><span class="linenos"> 89</span></a><span class="sd">        Create a Graph instance from a mixing matrix.</span>
</span><span id="Graph-90"><a href="#Graph-90"><span class="linenos"> 90</span></a><span class="sd">        The mixing matrix must be symmetric doubly stochastic.</span>
</span><span id="Graph-91"><a href="#Graph-91"><span class="linenos"> 91</span></a>
</span><span id="Graph-92"><a href="#Graph-92"><span class="linenos"> 92</span></a><span class="sd">        Parameters</span>
</span><span id="Graph-93"><a href="#Graph-93"><span class="linenos"> 93</span></a><span class="sd">        ----------</span>
</span><span id="Graph-94"><a href="#Graph-94"><span class="linenos"> 94</span></a><span class="sd">        mixing_matrix : NDArray[float64]</span>
</span><span id="Graph-95"><a href="#Graph-95"><span class="linenos"> 95</span></a><span class="sd">            A square matrix representing the mixing coefficients between nodes.</span>
</span><span id="Graph-96"><a href="#Graph-96"><span class="linenos"> 96</span></a>
</span><span id="Graph-97"><a href="#Graph-97"><span class="linenos"> 97</span></a><span class="sd">        nodelist : list[str], optional</span>
</span><span id="Graph-98"><a href="#Graph-98"><span class="linenos"> 98</span></a><span class="sd">            A list of self defined node names. If not provided, nodes will be named sequentially as &quot;1&quot;, &quot;2&quot;, ..., &quot;n&quot;.</span>
</span><span id="Graph-99"><a href="#Graph-99"><span class="linenos"> 99</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Graph-100"><a href="#Graph-100"><span class="linenos">100</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_symmetric_doubly_stochastic</span><span class="p">(</span><span class="n">mixing_matrix</span><span class="p">):</span>
</span><span id="Graph-101"><a href="#Graph-101"><span class="linenos">101</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;The mixing matrix must be symmetric doubly stochastic.&quot;</span>
</span><span id="Graph-102"><a href="#Graph-102"><span class="linenos">102</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="Graph-103"><a href="#Graph-103"><span class="linenos">103</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="Graph-104"><a href="#Graph-104"><span class="linenos">104</span></a>
</span><span id="Graph-105"><a href="#Graph-105"><span class="linenos">105</span></a>        <span class="n">mixing_matrix_no_self</span> <span class="o">=</span> <span class="n">mixing_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Graph-106"><a href="#Graph-106"><span class="linenos">106</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">mixing_matrix_no_self</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Graph-107"><a href="#Graph-107"><span class="linenos">107</span></a>        <span class="n">nx_graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_numpy_array</span><span class="p">(</span><span class="n">mixing_matrix_no_self</span><span class="p">,</span> <span class="n">create_using</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">)</span>
</span><span id="Graph-108"><a href="#Graph-108"><span class="linenos">108</span></a>
</span><span id="Graph-109"><a href="#Graph-109"><span class="linenos">109</span></a>        <span class="k">if</span> <span class="n">nodelist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Graph-110"><a href="#Graph-110"><span class="linenos">110</span></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">mixing_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Graph-111"><a href="#Graph-111"><span class="linenos">111</span></a>            <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)}</span>
</span><span id="Graph-112"><a href="#Graph-112"><span class="linenos">112</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodelist</span><span class="p">)</span> <span class="o">==</span> <span class="n">mixing_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Graph-113"><a href="#Graph-113"><span class="linenos">113</span></a>            <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">nodelist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mixing_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span>
</span><span id="Graph-114"><a href="#Graph-114"><span class="linenos">114</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Graph-115"><a href="#Graph-115"><span class="linenos">115</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Length of nodelist must match the size of the mixing matrix.&quot;</span>
</span><span id="Graph-116"><a href="#Graph-116"><span class="linenos">116</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="Graph-117"><a href="#Graph-117"><span class="linenos">117</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="Graph-118"><a href="#Graph-118"><span class="linenos">118</span></a>
</span><span id="Graph-119"><a href="#Graph-119"><span class="linenos">119</span></a>        <span class="n">nx_graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">relabel_nodes</span><span class="p">(</span><span class="n">nx_graph</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
</span><span id="Graph-120"><a href="#Graph-120"><span class="linenos">120</span></a>
</span><span id="Graph-121"><a href="#Graph-121"><span class="linenos">121</span></a>        <span class="n">graph</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span><span id="Graph-122"><a href="#Graph-122"><span class="linenos">122</span></a>        <span class="n">graph</span><span class="o">.</span><span class="n">_nx_graph</span> <span class="o">=</span> <span class="n">nx_graph</span>
</span><span id="Graph-123"><a href="#Graph-123"><span class="linenos">123</span></a>
</span><span id="Graph-124"><a href="#Graph-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="n">graph</span>
</span><span id="Graph-125"><a href="#Graph-125"><span class="linenos">125</span></a>
</span><span id="Graph-126"><a href="#Graph-126"><span class="linenos">126</span></a>    <span class="nd">@property</span>
</span><span id="Graph-127"><a href="#Graph-127"><span class="linenos">127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NodeView</span><span class="p">:</span>
</span><span id="Graph-128"><a href="#Graph-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">nodes</span>
</span><span id="Graph-129"><a href="#Graph-129"><span class="linenos">129</span></a>
</span><span id="Graph-130"><a href="#Graph-130"><span class="linenos">130</span></a>    <span class="nd">@property</span>
</span><span id="Graph-131"><a href="#Graph-131"><span class="linenos">131</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EdgeView</span><span class="p">:</span>
</span><span id="Graph-132"><a href="#Graph-132"><span class="linenos">132</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">edges</span>
</span><span id="Graph-133"><a href="#Graph-133"><span class="linenos">133</span></a>
</span><span id="Graph-134"><a href="#Graph-134"><span class="linenos">134</span></a>    <span class="nd">@property</span>
</span><span id="Graph-135"><a href="#Graph-135"><span class="linenos">135</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">number_of_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Graph-136"><a href="#Graph-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
</span><span id="Graph-137"><a href="#Graph-137"><span class="linenos">137</span></a>
</span><span id="Graph-138"><a href="#Graph-138"><span class="linenos">138</span></a>    <span class="nd">@property</span>
</span><span id="Graph-139"><a href="#Graph-139"><span class="linenos">139</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">number_of_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Graph-140"><a href="#Graph-140"><span class="linenos">140</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
</span><span id="Graph-141"><a href="#Graph-141"><span class="linenos">141</span></a>
</span><span id="Graph-142"><a href="#Graph-142"><span class="linenos">142</span></a>    <span class="nd">@property</span>
</span><span id="Graph-143"><a href="#Graph-143"><span class="linenos">143</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Graph-144"><a href="#Graph-144"><span class="linenos">144</span></a>        <span class="k">return</span> <span class="n">nx</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="p">)</span>
</span><span id="Graph-145"><a href="#Graph-145"><span class="linenos">145</span></a>
</span><span id="Graph-146"><a href="#Graph-146"><span class="linenos">146</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="n">NodeInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Graph-147"><a href="#Graph-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Graph-148"><a href="#Graph-148"><span class="linenos">148</span></a><span class="sd">        Add nodes to the graph.</span>
</span><span id="Graph-149"><a href="#Graph-149"><span class="linenos">149</span></a>
</span><span id="Graph-150"><a href="#Graph-150"><span class="linenos">150</span></a><span class="sd">        Parameters</span>
</span><span id="Graph-151"><a href="#Graph-151"><span class="linenos">151</span></a><span class="sd">        ----------</span>
</span><span id="Graph-152"><a href="#Graph-152"><span class="linenos">152</span></a><span class="sd">        nodes : NodeInput</span>
</span><span id="Graph-153"><a href="#Graph-153"><span class="linenos">153</span></a><span class="sd">            An iterable of node names to add to the graph.</span>
</span><span id="Graph-154"><a href="#Graph-154"><span class="linenos">154</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Graph-155"><a href="#Graph-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
</span><span id="Graph-156"><a href="#Graph-156"><span class="linenos">156</span></a>
</span><span id="Graph-157"><a href="#Graph-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="p">:</span> <span class="n">EdgeInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Graph-158"><a href="#Graph-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Graph-159"><a href="#Graph-159"><span class="linenos">159</span></a><span class="sd">        Add edges to the graph.</span>
</span><span id="Graph-160"><a href="#Graph-160"><span class="linenos">160</span></a>
</span><span id="Graph-161"><a href="#Graph-161"><span class="linenos">161</span></a><span class="sd">        Parameters</span>
</span><span id="Graph-162"><a href="#Graph-162"><span class="linenos">162</span></a><span class="sd">        ----------</span>
</span><span id="Graph-163"><a href="#Graph-163"><span class="linenos">163</span></a><span class="sd">        edges : EdgeInput</span>
</span><span id="Graph-164"><a href="#Graph-164"><span class="linenos">164</span></a><span class="sd">            An iterable of edges (tuples of node names) to add to the graph.</span>
</span><span id="Graph-165"><a href="#Graph-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Graph-166"><a href="#Graph-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
</span><span id="Graph-167"><a href="#Graph-167"><span class="linenos">167</span></a>
</span><span id="Graph-168"><a href="#Graph-168"><span class="linenos">168</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">adjacency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AdjView</span><span class="p">:</span>
</span><span id="Graph-169"><a href="#Graph-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Graph-170"><a href="#Graph-170"><span class="linenos">170</span></a><span class="sd">        Get the adjacency view of a specific node i.</span>
</span><span id="Graph-171"><a href="#Graph-171"><span class="linenos">171</span></a>
</span><span id="Graph-172"><a href="#Graph-172"><span class="linenos">172</span></a><span class="sd">        Parameters</span>
</span><span id="Graph-173"><a href="#Graph-173"><span class="linenos">173</span></a><span class="sd">        ----------</span>
</span><span id="Graph-174"><a href="#Graph-174"><span class="linenos">174</span></a><span class="sd">        i : str</span>
</span><span id="Graph-175"><a href="#Graph-175"><span class="linenos">175</span></a><span class="sd">            The name of the node.</span>
</span><span id="Graph-176"><a href="#Graph-176"><span class="linenos">176</span></a>
</span><span id="Graph-177"><a href="#Graph-177"><span class="linenos">177</span></a><span class="sd">        Returns</span>
</span><span id="Graph-178"><a href="#Graph-178"><span class="linenos">178</span></a><span class="sd">        -------</span>
</span><span id="Graph-179"><a href="#Graph-179"><span class="linenos">179</span></a><span class="sd">        AdjView</span>
</span><span id="Graph-180"><a href="#Graph-180"><span class="linenos">180</span></a><span class="sd">            The adjacency view of the specified node.</span>
</span><span id="Graph-181"><a href="#Graph-181"><span class="linenos">181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Graph-182"><a href="#Graph-182"><span class="linenos">182</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Graph-183"><a href="#Graph-183"><span class="linenos">183</span></a>
</span><span id="Graph-184"><a href="#Graph-184"><span class="linenos">184</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_neighbor_info_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NeighborInfo</span><span class="p">]:</span>
</span><span id="Graph-185"><a href="#Graph-185"><span class="linenos">185</span></a>        <span class="c1"># When the assert fails, it indicates a bug in the deployment logic.</span>
</span><span id="Graph-186"><a href="#Graph-186"><span class="linenos">186</span></a>        <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Node &#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&#39; is not defined in the graph.&quot;</span>
</span><span id="Graph-187"><a href="#Graph-187"><span class="linenos">187</span></a>
</span><span id="Graph-188"><a href="#Graph-188"><span class="linenos">188</span></a>        <span class="n">neighbor_info_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NeighborInfo</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Graph-189"><a href="#Graph-189"><span class="linenos">189</span></a>        <span class="n">n_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacency</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="Graph-190"><a href="#Graph-190"><span class="linenos">190</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">n_i</span><span class="p">:</span>
</span><span id="Graph-191"><a href="#Graph-191"><span class="linenos">191</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_registry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="Graph-192"><a href="#Graph-192"><span class="linenos">192</span></a>
</span><span id="Graph-193"><a href="#Graph-193"><span class="linenos">193</span></a>            <span class="c1"># When the assert fails, it indicates a bug in the deployment logic.</span>
</span><span id="Graph-194"><a href="#Graph-194"><span class="linenos">194</span></a>            <span class="k">assert</span> <span class="n">endpoint</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Node &#39;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&#39; has not registered.&quot;</span>
</span><span id="Graph-195"><a href="#Graph-195"><span class="linenos">195</span></a>
</span><span id="Graph-196"><a href="#Graph-196"><span class="linenos">196</span></a>            <span class="n">weight</span> <span class="o">=</span> <span class="n">n_i</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="Graph-197"><a href="#Graph-197"><span class="linenos">197</span></a>            <span class="n">info</span> <span class="o">=</span> <span class="n">NeighborInfo</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
</span><span id="Graph-198"><a href="#Graph-198"><span class="linenos">198</span></a>            <span class="n">neighbor_info_dict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>
</span><span id="Graph-199"><a href="#Graph-199"><span class="linenos">199</span></a>
</span><span id="Graph-200"><a href="#Graph-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="n">neighbor_info_dict</span>
</span><span id="Graph-201"><a href="#Graph-201"><span class="linenos">201</span></a>
</span><span id="Graph-202"><a href="#Graph-202"><span class="linenos">202</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_router</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">zmq</span><span class="o">.</span><span class="n">Socket</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Graph-203"><a href="#Graph-203"><span class="linenos">203</span></a>        <span class="n">router</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">ROUTER</span><span class="p">)</span>
</span><span id="Graph-204"><a href="#Graph-204"><span class="linenos">204</span></a>        <span class="n">port</span> <span class="o">=</span> <span class="n">router</span><span class="o">.</span><span class="n">bind_to_random_port</span><span class="p">(</span><span class="s2">&quot;tcp://*&quot;</span><span class="p">)</span>
</span><span id="Graph-205"><a href="#Graph-205"><span class="linenos">205</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Graph &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39; running on: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip_address</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Graph-206"><a href="#Graph-206"><span class="linenos">206</span></a>
</span><span id="Graph-207"><a href="#Graph-207"><span class="linenos">207</span></a>        <span class="k">return</span> <span class="n">router</span><span class="p">,</span> <span class="n">port</span>
</span><span id="Graph-208"><a href="#Graph-208"><span class="linenos">208</span></a>
</span><span id="Graph-209"><a href="#Graph-209"><span class="linenos">209</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_register_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Graph-210"><a href="#Graph-210"><span class="linenos">210</span></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_registry</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">:</span>
</span><span id="Graph-211"><a href="#Graph-211"><span class="linenos">211</span></a>            <span class="n">rid</span><span class="p">,</span> <span class="n">idx_bytes</span><span class="p">,</span> <span class="n">endpoint_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="o">.</span><span class="n">recv_multipart</span><span class="p">()</span>
</span><span id="Graph-212"><a href="#Graph-212"><span class="linenos">212</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">idx_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span id="Graph-213"><a href="#Graph-213"><span class="linenos">213</span></a>
</span><span id="Graph-214"><a href="#Graph-214"><span class="linenos">214</span></a>            <span class="k">if</span> <span class="n">idx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="Graph-215"><a href="#Graph-215"><span class="linenos">215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">([</span><span class="n">rid</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;Error: Undefined node&quot;</span><span class="p">])</span>
</span><span id="Graph-216"><a href="#Graph-216"><span class="linenos">216</span></a>                <span class="k">continue</span>
</span><span id="Graph-217"><a href="#Graph-217"><span class="linenos">217</span></a>
</span><span id="Graph-218"><a href="#Graph-218"><span class="linenos">218</span></a>            <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_registry</span><span class="p">:</span>
</span><span id="Graph-219"><a href="#Graph-219"><span class="linenos">219</span></a>                <span class="n">old_rid</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_registry</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="Graph-220"><a href="#Graph-220"><span class="linenos">220</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">([</span><span class="n">old_rid</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;Error: Node replaced&quot;</span><span class="p">])</span>
</span><span id="Graph-221"><a href="#Graph-221"><span class="linenos">221</span></a>
</span><span id="Graph-222"><a href="#Graph-222"><span class="linenos">222</span></a>            <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoint_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span id="Graph-223"><a href="#Graph-223"><span class="linenos">223</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_node_registry</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>
</span><span id="Graph-224"><a href="#Graph-224"><span class="linenos">224</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node &#39;</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&#39; joined graph &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39; from </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="Graph-225"><a href="#Graph-225"><span class="linenos">225</span></a>
</span><span id="Graph-226"><a href="#Graph-226"><span class="linenos">226</span></a>        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_registry</span><span class="p">:</span>
</span><span id="Graph-227"><a href="#Graph-227"><span class="linenos">227</span></a>            <span class="n">rid</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_registry</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="Graph-228"><a href="#Graph-228"><span class="linenos">228</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">([</span><span class="n">rid</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;OK&quot;</span><span class="p">])</span>
</span><span id="Graph-229"><a href="#Graph-229"><span class="linenos">229</span></a>
</span><span id="Graph-230"><a href="#Graph-230"><span class="linenos">230</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Graph &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39; registration complete.&quot;</span><span class="p">)</span>
</span><span id="Graph-231"><a href="#Graph-231"><span class="linenos">231</span></a>
</span><span id="Graph-232"><a href="#Graph-232"><span class="linenos">232</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_notify_nodes_of_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Graph-233"><a href="#Graph-233"><span class="linenos">233</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="Graph-234"><a href="#Graph-234"><span class="linenos">234</span></a>            <span class="n">neighbor_info_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_neighbor_info_dict</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="Graph-235"><a href="#Graph-235"><span class="linenos">235</span></a>            <span class="n">messages</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">neighbor_info_dict</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="Graph-236"><a href="#Graph-236"><span class="linenos">236</span></a>            <span class="n">rid</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_registry</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Graph-237"><a href="#Graph-237"><span class="linenos">237</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">([</span><span class="n">rid</span><span class="p">,</span> <span class="n">messages</span><span class="p">])</span>
</span><span id="Graph-238"><a href="#Graph-238"><span class="linenos">238</span></a>
</span><span id="Graph-239"><a href="#Graph-239"><span class="linenos">239</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sent neighbor information to all nodes in graph &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
</span><span id="Graph-240"><a href="#Graph-240"><span class="linenos">240</span></a>
</span><span id="Graph-241"><a href="#Graph-241"><span class="linenos">241</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">deploy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Graph-242"><a href="#Graph-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Graph-243"><a href="#Graph-243"><span class="linenos">243</span></a><span class="sd">        Deploy the network topology.</span>
</span><span id="Graph-244"><a href="#Graph-244"><span class="linenos">244</span></a><span class="sd">        This method handles the registration of nodes, sends them their neighbor information,</span>
</span><span id="Graph-245"><a href="#Graph-245"><span class="linenos">245</span></a><span class="sd">        and ensures proper cleanup of resources after deployment.</span>
</span><span id="Graph-246"><a href="#Graph-246"><span class="linenos">246</span></a>
</span><span id="Graph-247"><a href="#Graph-247"><span class="linenos">247</span></a><span class="sd">        This process is only responsible for deploying the network topology.</span>
</span><span id="Graph-248"><a href="#Graph-248"><span class="linenos">248</span></a><span class="sd">        It does not take part in the actual communication between nodes.</span>
</span><span id="Graph-249"><a href="#Graph-249"><span class="linenos">249</span></a><span class="sd">        Once all nodes are registered and notified, the process will shut down automatically.</span>
</span><span id="Graph-250"><a href="#Graph-250"><span class="linenos">250</span></a>
</span><span id="Graph-251"><a href="#Graph-251"><span class="linenos">251</span></a><span class="sd">        Raises</span>
</span><span id="Graph-252"><a href="#Graph-252"><span class="linenos">252</span></a><span class="sd">        ------</span>
</span><span id="Graph-253"><a href="#Graph-253"><span class="linenos">253</span></a><span class="sd">        ValueError</span>
</span><span id="Graph-254"><a href="#Graph-254"><span class="linenos">254</span></a><span class="sd">            If the graph is not connected.</span>
</span><span id="Graph-255"><a href="#Graph-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Graph-256"><a href="#Graph-256"><span class="linenos">256</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Graph-257"><a href="#Graph-257"><span class="linenos">257</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
</span><span id="Graph-258"><a href="#Graph-258"><span class="linenos">258</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;The graph is not connected.&quot;</span>
</span><span id="Graph-259"><a href="#Graph-259"><span class="linenos">259</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="Graph-260"><a href="#Graph-260"><span class="linenos">260</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="Graph-261"><a href="#Graph-261"><span class="linenos">261</span></a>
</span><span id="Graph-262"><a href="#Graph-262"><span class="linenos">262</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_register_nodes</span><span class="p">()</span>
</span><span id="Graph-263"><a href="#Graph-263"><span class="linenos">263</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_notify_nodes_of_neighbors</span><span class="p">()</span>
</span><span id="Graph-264"><a href="#Graph-264"><span class="linenos">264</span></a>            <span class="c1"># TODO: More deployment logic can be added here if needed.</span>
</span><span id="Graph-265"><a href="#Graph-265"><span class="linenos">265</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="Graph-266"><a href="#Graph-266"><span class="linenos">266</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Graph-267"><a href="#Graph-267"><span class="linenos">267</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">term</span><span class="p">()</span>
</span><span id="Graph-268"><a href="#Graph-268"><span class="linenos">268</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_graph_advertiser</span><span class="o">.</span><span class="n">unregister</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Represents a network topology using a NetworkX graph and provides methods for managing nodes, edges, and network deployment.</p>

<h2 id="parameters">Parameters</h2>

<p>nodes : NodeInput | None, optional
    An iterable of node names to initialize the graph. If None, the graph starts empty.</p>

<p>edges : EdgeInput | None, optional
    An iterable of edges (tuples of node names) to initialize the graph. If None, the graph starts with no edges.</p>

<p>name : str, optional
    The name of the graph service. Default is "default". When deploying multiple graphs, ensure each has a unique name.</p>

<h2 id="attributes">Attributes</h2>

<p>nodes : NodeView
    A view of the nodes in the graph.</p>

<p>edges : EdgeView
    A view of the edges in the graph.</p>

<p>number_of_nodes : int
    The number of nodes in the graph.</p>

<p>number_of_edges : int
    The number of edges in the graph.</p>

<p>is_connected : bool
    Indicates whether the graph is connected.</p>

<h2 id="notes">Notes</h2>

<ul>
<li>The graph must be connected before deployment.</li>
<li>The <code><a href="#Graph.from_mixing_matrix">from_mixing_matrix</a></code> method provides a convenient way to create a graph from a mixing matrix, ensuring the matrix is symmetric and double-stochastic.</li>
<li>Throughout the code, we use 'i' to denote the current node and 'j' to denote neighbor nodes, following common conventions in graph theory and distributed algorithms.</li>
</ul>
</div>


                            <div id="Graph.__init__" class="classattr">
                                        <input id="Graph.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Graph</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">nodes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">edges</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span></span>)</span>

                <label class="view-source-button" for="Graph.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Graph.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Graph.__init__-56"><a href="#Graph.__init__-56"><span class="linenos">56</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Graph.__init__-57"><a href="#Graph.__init__-57"><span class="linenos">57</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Graph.__init__-58"><a href="#Graph.__init__-58"><span class="linenos">58</span></a>        <span class="n">nodes</span><span class="p">:</span> <span class="n">NodeInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Graph.__init__-59"><a href="#Graph.__init__-59"><span class="linenos">59</span></a>        <span class="n">edges</span><span class="p">:</span> <span class="n">EdgeInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Graph.__init__-60"><a href="#Graph.__init__-60"><span class="linenos">60</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="Graph.__init__-61"><a href="#Graph.__init__-61"><span class="linenos">61</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Graph.__init__-62"><a href="#Graph.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
</span><span id="Graph.__init__-63"><a href="#Graph.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">nodes</span> <span class="ow">or</span> <span class="p">[])</span>
</span><span id="Graph.__init__-64"><a href="#Graph.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">edges</span> <span class="ow">or</span> <span class="p">[])</span>
</span><span id="Graph.__init__-65"><a href="#Graph.__init__-65"><span class="linenos">65</span></a>
</span><span id="Graph.__init__-66"><a href="#Graph.__init__-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="o">=</span> <span class="n">zmq</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
</span><span id="Graph.__init__-67"><a href="#Graph.__init__-67"><span class="linenos">67</span></a>
</span><span id="Graph.__init__-68"><a href="#Graph.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Graph.__init__-69"><a href="#Graph.__init__-69"><span class="linenos">69</span></a>
</span><span id="Graph.__init__-70"><a href="#Graph.__init__-70"><span class="linenos">70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_advertiser</span> <span class="o">=</span> <span class="n">GraphAdvertiser</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="Graph.__init__-71"><a href="#Graph.__init__-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ip_address</span> <span class="o">=</span> <span class="n">get_local_ip</span><span class="p">()</span>
</span><span id="Graph.__init__-72"><a href="#Graph.__init__-72"><span class="linenos">72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_router</span><span class="p">()</span>
</span><span id="Graph.__init__-73"><a href="#Graph.__init__-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_advertiser</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip_address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_port</span><span class="p">)</span>
</span><span id="Graph.__init__-74"><a href="#Graph.__init__-74"><span class="linenos">74</span></a>
</span><span id="Graph.__init__-75"><a href="#Graph.__init__-75"><span class="linenos">75</span></a>        <span class="c1"># idx: (rid: the router identity, endpoint: ip and port of the node)</span>
</span><span id="Graph.__init__-76"><a href="#Graph.__init__-76"><span class="linenos">76</span></a>        <span class="c1"># We do not use the node index as the ROUTER identity, so that multiple</span>
</span><span id="Graph.__init__-77"><a href="#Graph.__init__-77"><span class="linenos">77</span></a>        <span class="c1"># connections with the same idx can be distinguished during registration</span>
</span><span id="Graph.__init__-78"><a href="#Graph.__init__-78"><span class="linenos">78</span></a>        <span class="c1"># (e.g., to properly reject or replace duplicate nodes).</span>
</span><span id="Graph.__init__-79"><a href="#Graph.__init__-79"><span class="linenos">79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_node_registry</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span></pre></div>


    

                            </div>
                            <div id="Graph.from_mixing_matrix" class="classattr">
                                        <input id="Graph.from_mixing_matrix-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_mixing_matrix</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">mixing_matrix</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span>,</span><span class="param">	<span class="n">nodelist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span></span><span class="return-annotation">) -> <span class="n"><a href="#Graph">Graph</a></span>:</span></span>

                <label class="view-source-button" for="Graph.from_mixing_matrix-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Graph.from_mixing_matrix"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Graph.from_mixing_matrix-81"><a href="#Graph.from_mixing_matrix-81"><span class="linenos"> 81</span></a>    <span class="nd">@classmethod</span>
</span><span id="Graph.from_mixing_matrix-82"><a href="#Graph.from_mixing_matrix-82"><span class="linenos"> 82</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_mixing_matrix</span><span class="p">(</span>
</span><span id="Graph.from_mixing_matrix-83"><a href="#Graph.from_mixing_matrix-83"><span class="linenos"> 83</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="Graph.from_mixing_matrix-84"><a href="#Graph.from_mixing_matrix-84"><span class="linenos"> 84</span></a>        <span class="n">mixing_matrix</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
</span><span id="Graph.from_mixing_matrix-85"><a href="#Graph.from_mixing_matrix-85"><span class="linenos"> 85</span></a>        <span class="n">nodelist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Graph.from_mixing_matrix-86"><a href="#Graph.from_mixing_matrix-86"><span class="linenos"> 86</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="Graph.from_mixing_matrix-87"><a href="#Graph.from_mixing_matrix-87"><span class="linenos"> 87</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Graph&quot;</span><span class="p">:</span>
</span><span id="Graph.from_mixing_matrix-88"><a href="#Graph.from_mixing_matrix-88"><span class="linenos"> 88</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Graph.from_mixing_matrix-89"><a href="#Graph.from_mixing_matrix-89"><span class="linenos"> 89</span></a><span class="sd">        Create a Graph instance from a mixing matrix.</span>
</span><span id="Graph.from_mixing_matrix-90"><a href="#Graph.from_mixing_matrix-90"><span class="linenos"> 90</span></a><span class="sd">        The mixing matrix must be symmetric doubly stochastic.</span>
</span><span id="Graph.from_mixing_matrix-91"><a href="#Graph.from_mixing_matrix-91"><span class="linenos"> 91</span></a>
</span><span id="Graph.from_mixing_matrix-92"><a href="#Graph.from_mixing_matrix-92"><span class="linenos"> 92</span></a><span class="sd">        Parameters</span>
</span><span id="Graph.from_mixing_matrix-93"><a href="#Graph.from_mixing_matrix-93"><span class="linenos"> 93</span></a><span class="sd">        ----------</span>
</span><span id="Graph.from_mixing_matrix-94"><a href="#Graph.from_mixing_matrix-94"><span class="linenos"> 94</span></a><span class="sd">        mixing_matrix : NDArray[float64]</span>
</span><span id="Graph.from_mixing_matrix-95"><a href="#Graph.from_mixing_matrix-95"><span class="linenos"> 95</span></a><span class="sd">            A square matrix representing the mixing coefficients between nodes.</span>
</span><span id="Graph.from_mixing_matrix-96"><a href="#Graph.from_mixing_matrix-96"><span class="linenos"> 96</span></a>
</span><span id="Graph.from_mixing_matrix-97"><a href="#Graph.from_mixing_matrix-97"><span class="linenos"> 97</span></a><span class="sd">        nodelist : list[str], optional</span>
</span><span id="Graph.from_mixing_matrix-98"><a href="#Graph.from_mixing_matrix-98"><span class="linenos"> 98</span></a><span class="sd">            A list of self defined node names. If not provided, nodes will be named sequentially as &quot;1&quot;, &quot;2&quot;, ..., &quot;n&quot;.</span>
</span><span id="Graph.from_mixing_matrix-99"><a href="#Graph.from_mixing_matrix-99"><span class="linenos"> 99</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Graph.from_mixing_matrix-100"><a href="#Graph.from_mixing_matrix-100"><span class="linenos">100</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_symmetric_doubly_stochastic</span><span class="p">(</span><span class="n">mixing_matrix</span><span class="p">):</span>
</span><span id="Graph.from_mixing_matrix-101"><a href="#Graph.from_mixing_matrix-101"><span class="linenos">101</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;The mixing matrix must be symmetric doubly stochastic.&quot;</span>
</span><span id="Graph.from_mixing_matrix-102"><a href="#Graph.from_mixing_matrix-102"><span class="linenos">102</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="Graph.from_mixing_matrix-103"><a href="#Graph.from_mixing_matrix-103"><span class="linenos">103</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="Graph.from_mixing_matrix-104"><a href="#Graph.from_mixing_matrix-104"><span class="linenos">104</span></a>
</span><span id="Graph.from_mixing_matrix-105"><a href="#Graph.from_mixing_matrix-105"><span class="linenos">105</span></a>        <span class="n">mixing_matrix_no_self</span> <span class="o">=</span> <span class="n">mixing_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Graph.from_mixing_matrix-106"><a href="#Graph.from_mixing_matrix-106"><span class="linenos">106</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">mixing_matrix_no_self</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Graph.from_mixing_matrix-107"><a href="#Graph.from_mixing_matrix-107"><span class="linenos">107</span></a>        <span class="n">nx_graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_numpy_array</span><span class="p">(</span><span class="n">mixing_matrix_no_self</span><span class="p">,</span> <span class="n">create_using</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">)</span>
</span><span id="Graph.from_mixing_matrix-108"><a href="#Graph.from_mixing_matrix-108"><span class="linenos">108</span></a>
</span><span id="Graph.from_mixing_matrix-109"><a href="#Graph.from_mixing_matrix-109"><span class="linenos">109</span></a>        <span class="k">if</span> <span class="n">nodelist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Graph.from_mixing_matrix-110"><a href="#Graph.from_mixing_matrix-110"><span class="linenos">110</span></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">mixing_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Graph.from_mixing_matrix-111"><a href="#Graph.from_mixing_matrix-111"><span class="linenos">111</span></a>            <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)}</span>
</span><span id="Graph.from_mixing_matrix-112"><a href="#Graph.from_mixing_matrix-112"><span class="linenos">112</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodelist</span><span class="p">)</span> <span class="o">==</span> <span class="n">mixing_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Graph.from_mixing_matrix-113"><a href="#Graph.from_mixing_matrix-113"><span class="linenos">113</span></a>            <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">nodelist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mixing_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span>
</span><span id="Graph.from_mixing_matrix-114"><a href="#Graph.from_mixing_matrix-114"><span class="linenos">114</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Graph.from_mixing_matrix-115"><a href="#Graph.from_mixing_matrix-115"><span class="linenos">115</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Length of nodelist must match the size of the mixing matrix.&quot;</span>
</span><span id="Graph.from_mixing_matrix-116"><a href="#Graph.from_mixing_matrix-116"><span class="linenos">116</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="Graph.from_mixing_matrix-117"><a href="#Graph.from_mixing_matrix-117"><span class="linenos">117</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="Graph.from_mixing_matrix-118"><a href="#Graph.from_mixing_matrix-118"><span class="linenos">118</span></a>
</span><span id="Graph.from_mixing_matrix-119"><a href="#Graph.from_mixing_matrix-119"><span class="linenos">119</span></a>        <span class="n">nx_graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">relabel_nodes</span><span class="p">(</span><span class="n">nx_graph</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
</span><span id="Graph.from_mixing_matrix-120"><a href="#Graph.from_mixing_matrix-120"><span class="linenos">120</span></a>
</span><span id="Graph.from_mixing_matrix-121"><a href="#Graph.from_mixing_matrix-121"><span class="linenos">121</span></a>        <span class="n">graph</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span><span id="Graph.from_mixing_matrix-122"><a href="#Graph.from_mixing_matrix-122"><span class="linenos">122</span></a>        <span class="n">graph</span><span class="o">.</span><span class="n">_nx_graph</span> <span class="o">=</span> <span class="n">nx_graph</span>
</span><span id="Graph.from_mixing_matrix-123"><a href="#Graph.from_mixing_matrix-123"><span class="linenos">123</span></a>
</span><span id="Graph.from_mixing_matrix-124"><a href="#Graph.from_mixing_matrix-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="n">graph</span>
</span></pre></div>


            <div class="docstring"><p>Create a Graph instance from a mixing matrix.
The mixing matrix must be symmetric doubly stochastic.</p>

<h2 id="parameters">Parameters</h2>

<p>mixing_matrix : NDArray[float64]
    A square matrix representing the mixing coefficients between nodes.</p>

<p>nodelist : list[str], optional
    A list of self defined node names. If not provided, nodes will be named sequentially as "1", "2", ..., "n".</p>
</div>


                            </div>
                            <div id="Graph.nodes" class="classattr">
                                        <input id="Graph.nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">nodes</span><span class="annotation">: Collection[str]</span>

                <label class="view-source-button" for="Graph.nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Graph.nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Graph.nodes-126"><a href="#Graph.nodes-126"><span class="linenos">126</span></a>    <span class="nd">@property</span>
</span><span id="Graph.nodes-127"><a href="#Graph.nodes-127"><span class="linenos">127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NodeView</span><span class="p">:</span>
</span><span id="Graph.nodes-128"><a href="#Graph.nodes-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">nodes</span>
</span></pre></div>


    

                            </div>
                            <div id="Graph.edges" class="classattr">
                                        <input id="Graph.edges-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">edges</span><span class="annotation">: Collection[tuple[str, str]]</span>

                <label class="view-source-button" for="Graph.edges-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Graph.edges"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Graph.edges-130"><a href="#Graph.edges-130"><span class="linenos">130</span></a>    <span class="nd">@property</span>
</span><span id="Graph.edges-131"><a href="#Graph.edges-131"><span class="linenos">131</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EdgeView</span><span class="p">:</span>
</span><span id="Graph.edges-132"><a href="#Graph.edges-132"><span class="linenos">132</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">edges</span>
</span></pre></div>


    

                            </div>
                            <div id="Graph.number_of_nodes" class="classattr">
                                        <input id="Graph.number_of_nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">number_of_nodes</span><span class="annotation">: int</span>

                <label class="view-source-button" for="Graph.number_of_nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Graph.number_of_nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Graph.number_of_nodes-134"><a href="#Graph.number_of_nodes-134"><span class="linenos">134</span></a>    <span class="nd">@property</span>
</span><span id="Graph.number_of_nodes-135"><a href="#Graph.number_of_nodes-135"><span class="linenos">135</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">number_of_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Graph.number_of_nodes-136"><a href="#Graph.number_of_nodes-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="Graph.number_of_edges" class="classattr">
                                        <input id="Graph.number_of_edges-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">number_of_edges</span><span class="annotation">: int</span>

                <label class="view-source-button" for="Graph.number_of_edges-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Graph.number_of_edges"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Graph.number_of_edges-138"><a href="#Graph.number_of_edges-138"><span class="linenos">138</span></a>    <span class="nd">@property</span>
</span><span id="Graph.number_of_edges-139"><a href="#Graph.number_of_edges-139"><span class="linenos">139</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">number_of_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Graph.number_of_edges-140"><a href="#Graph.number_of_edges-140"><span class="linenos">140</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="Graph.is_connected" class="classattr">
                                        <input id="Graph.is_connected-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">is_connected</span><span class="annotation">: bool</span>

                <label class="view-source-button" for="Graph.is_connected-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Graph.is_connected"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Graph.is_connected-142"><a href="#Graph.is_connected-142"><span class="linenos">142</span></a>    <span class="nd">@property</span>
</span><span id="Graph.is_connected-143"><a href="#Graph.is_connected-143"><span class="linenos">143</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Graph.is_connected-144"><a href="#Graph.is_connected-144"><span class="linenos">144</span></a>        <span class="k">return</span> <span class="n">nx</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Graph.add_nodes" class="classattr">
                                        <input id="Graph.add_nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_nodes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">nodes</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Graph.add_nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Graph.add_nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Graph.add_nodes-146"><a href="#Graph.add_nodes-146"><span class="linenos">146</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="n">NodeInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Graph.add_nodes-147"><a href="#Graph.add_nodes-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Graph.add_nodes-148"><a href="#Graph.add_nodes-148"><span class="linenos">148</span></a><span class="sd">        Add nodes to the graph.</span>
</span><span id="Graph.add_nodes-149"><a href="#Graph.add_nodes-149"><span class="linenos">149</span></a>
</span><span id="Graph.add_nodes-150"><a href="#Graph.add_nodes-150"><span class="linenos">150</span></a><span class="sd">        Parameters</span>
</span><span id="Graph.add_nodes-151"><a href="#Graph.add_nodes-151"><span class="linenos">151</span></a><span class="sd">        ----------</span>
</span><span id="Graph.add_nodes-152"><a href="#Graph.add_nodes-152"><span class="linenos">152</span></a><span class="sd">        nodes : NodeInput</span>
</span><span id="Graph.add_nodes-153"><a href="#Graph.add_nodes-153"><span class="linenos">153</span></a><span class="sd">            An iterable of node names to add to the graph.</span>
</span><span id="Graph.add_nodes-154"><a href="#Graph.add_nodes-154"><span class="linenos">154</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Graph.add_nodes-155"><a href="#Graph.add_nodes-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add nodes to the graph.</p>

<h2 id="parameters">Parameters</h2>

<p>nodes : NodeInput
    An iterable of node names to add to the graph.</p>
</div>


                            </div>
                            <div id="Graph.add_edges" class="classattr">
                                        <input id="Graph.add_edges-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_edges</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">edges</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Graph.add_edges-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Graph.add_edges"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Graph.add_edges-157"><a href="#Graph.add_edges-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="p">:</span> <span class="n">EdgeInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Graph.add_edges-158"><a href="#Graph.add_edges-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Graph.add_edges-159"><a href="#Graph.add_edges-159"><span class="linenos">159</span></a><span class="sd">        Add edges to the graph.</span>
</span><span id="Graph.add_edges-160"><a href="#Graph.add_edges-160"><span class="linenos">160</span></a>
</span><span id="Graph.add_edges-161"><a href="#Graph.add_edges-161"><span class="linenos">161</span></a><span class="sd">        Parameters</span>
</span><span id="Graph.add_edges-162"><a href="#Graph.add_edges-162"><span class="linenos">162</span></a><span class="sd">        ----------</span>
</span><span id="Graph.add_edges-163"><a href="#Graph.add_edges-163"><span class="linenos">163</span></a><span class="sd">        edges : EdgeInput</span>
</span><span id="Graph.add_edges-164"><a href="#Graph.add_edges-164"><span class="linenos">164</span></a><span class="sd">            An iterable of edges (tuples of node names) to add to the graph.</span>
</span><span id="Graph.add_edges-165"><a href="#Graph.add_edges-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Graph.add_edges-166"><a href="#Graph.add_edges-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add edges to the graph.</p>

<h2 id="parameters">Parameters</h2>

<p>edges : EdgeInput
    An iterable of edges (tuples of node names) to add to the graph.</p>
</div>


                            </div>
                            <div id="Graph.adjacency" class="classattr">
                                        <input id="Graph.adjacency-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">adjacency</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">i</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="Graph.adjacency-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Graph.adjacency"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Graph.adjacency-168"><a href="#Graph.adjacency-168"><span class="linenos">168</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">adjacency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AdjView</span><span class="p">:</span>
</span><span id="Graph.adjacency-169"><a href="#Graph.adjacency-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Graph.adjacency-170"><a href="#Graph.adjacency-170"><span class="linenos">170</span></a><span class="sd">        Get the adjacency view of a specific node i.</span>
</span><span id="Graph.adjacency-171"><a href="#Graph.adjacency-171"><span class="linenos">171</span></a>
</span><span id="Graph.adjacency-172"><a href="#Graph.adjacency-172"><span class="linenos">172</span></a><span class="sd">        Parameters</span>
</span><span id="Graph.adjacency-173"><a href="#Graph.adjacency-173"><span class="linenos">173</span></a><span class="sd">        ----------</span>
</span><span id="Graph.adjacency-174"><a href="#Graph.adjacency-174"><span class="linenos">174</span></a><span class="sd">        i : str</span>
</span><span id="Graph.adjacency-175"><a href="#Graph.adjacency-175"><span class="linenos">175</span></a><span class="sd">            The name of the node.</span>
</span><span id="Graph.adjacency-176"><a href="#Graph.adjacency-176"><span class="linenos">176</span></a>
</span><span id="Graph.adjacency-177"><a href="#Graph.adjacency-177"><span class="linenos">177</span></a><span class="sd">        Returns</span>
</span><span id="Graph.adjacency-178"><a href="#Graph.adjacency-178"><span class="linenos">178</span></a><span class="sd">        -------</span>
</span><span id="Graph.adjacency-179"><a href="#Graph.adjacency-179"><span class="linenos">179</span></a><span class="sd">        AdjView</span>
</span><span id="Graph.adjacency-180"><a href="#Graph.adjacency-180"><span class="linenos">180</span></a><span class="sd">            The adjacency view of the specified node.</span>
</span><span id="Graph.adjacency-181"><a href="#Graph.adjacency-181"><span class="linenos">181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Graph.adjacency-182"><a href="#Graph.adjacency-182"><span class="linenos">182</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nx_graph</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Get the adjacency view of a specific node i.</p>

<h2 id="parameters">Parameters</h2>

<p>i : str
    The name of the node.</p>

<h2 id="returns">Returns</h2>

<p>AdjView
    The adjacency view of the specified node.</p>
</div>


                            </div>
                            <div id="Graph.deploy" class="classattr">
                                        <input id="Graph.deploy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">deploy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Graph.deploy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Graph.deploy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Graph.deploy-241"><a href="#Graph.deploy-241"><span class="linenos">241</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">deploy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Graph.deploy-242"><a href="#Graph.deploy-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Graph.deploy-243"><a href="#Graph.deploy-243"><span class="linenos">243</span></a><span class="sd">        Deploy the network topology.</span>
</span><span id="Graph.deploy-244"><a href="#Graph.deploy-244"><span class="linenos">244</span></a><span class="sd">        This method handles the registration of nodes, sends them their neighbor information,</span>
</span><span id="Graph.deploy-245"><a href="#Graph.deploy-245"><span class="linenos">245</span></a><span class="sd">        and ensures proper cleanup of resources after deployment.</span>
</span><span id="Graph.deploy-246"><a href="#Graph.deploy-246"><span class="linenos">246</span></a>
</span><span id="Graph.deploy-247"><a href="#Graph.deploy-247"><span class="linenos">247</span></a><span class="sd">        This process is only responsible for deploying the network topology.</span>
</span><span id="Graph.deploy-248"><a href="#Graph.deploy-248"><span class="linenos">248</span></a><span class="sd">        It does not take part in the actual communication between nodes.</span>
</span><span id="Graph.deploy-249"><a href="#Graph.deploy-249"><span class="linenos">249</span></a><span class="sd">        Once all nodes are registered and notified, the process will shut down automatically.</span>
</span><span id="Graph.deploy-250"><a href="#Graph.deploy-250"><span class="linenos">250</span></a>
</span><span id="Graph.deploy-251"><a href="#Graph.deploy-251"><span class="linenos">251</span></a><span class="sd">        Raises</span>
</span><span id="Graph.deploy-252"><a href="#Graph.deploy-252"><span class="linenos">252</span></a><span class="sd">        ------</span>
</span><span id="Graph.deploy-253"><a href="#Graph.deploy-253"><span class="linenos">253</span></a><span class="sd">        ValueError</span>
</span><span id="Graph.deploy-254"><a href="#Graph.deploy-254"><span class="linenos">254</span></a><span class="sd">            If the graph is not connected.</span>
</span><span id="Graph.deploy-255"><a href="#Graph.deploy-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Graph.deploy-256"><a href="#Graph.deploy-256"><span class="linenos">256</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Graph.deploy-257"><a href="#Graph.deploy-257"><span class="linenos">257</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
</span><span id="Graph.deploy-258"><a href="#Graph.deploy-258"><span class="linenos">258</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;The graph is not connected.&quot;</span>
</span><span id="Graph.deploy-259"><a href="#Graph.deploy-259"><span class="linenos">259</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="Graph.deploy-260"><a href="#Graph.deploy-260"><span class="linenos">260</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="Graph.deploy-261"><a href="#Graph.deploy-261"><span class="linenos">261</span></a>
</span><span id="Graph.deploy-262"><a href="#Graph.deploy-262"><span class="linenos">262</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_register_nodes</span><span class="p">()</span>
</span><span id="Graph.deploy-263"><a href="#Graph.deploy-263"><span class="linenos">263</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_notify_nodes_of_neighbors</span><span class="p">()</span>
</span><span id="Graph.deploy-264"><a href="#Graph.deploy-264"><span class="linenos">264</span></a>            <span class="c1"># TODO: More deployment logic can be added here if needed.</span>
</span><span id="Graph.deploy-265"><a href="#Graph.deploy-265"><span class="linenos">265</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="Graph.deploy-266"><a href="#Graph.deploy-266"><span class="linenos">266</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Graph.deploy-267"><a href="#Graph.deploy-267"><span class="linenos">267</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">term</span><span class="p">()</span>
</span><span id="Graph.deploy-268"><a href="#Graph.deploy-268"><span class="linenos">268</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_graph_advertiser</span><span class="o">.</span><span class="n">unregister</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Deploy the network topology.
This method handles the registration of nodes, sends them their neighbor information,
and ensures proper cleanup of resources after deployment.</p>

<p>This process is only responsible for deploying the network topology.
It does not take part in the actual communication between nodes.
Once all nodes are registered and notified, the process will shut down automatically.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the graph is not connected.</p>
</div>


                            </div>
                </section>
                <section id="NodeHandle">
                            <input id="NodeHandle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">NodeHandle</span>:

                <label class="view-source-button" for="NodeHandle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NodeHandle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NodeHandle-26"><a href="#NodeHandle-26"><span class="linenos"> 26</span></a><span class="k">class</span><span class="w"> </span><span class="nc">NodeHandle</span><span class="p">:</span>
</span><span id="NodeHandle-27"><a href="#NodeHandle-27"><span class="linenos"> 27</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NodeHandle-28"><a href="#NodeHandle-28"><span class="linenos"> 28</span></a><span class="sd">    NodeHandle manages communication and state exchange between a node and its neighbors in a distributed network.</span>
</span><span id="NodeHandle-29"><a href="#NodeHandle-29"><span class="linenos"> 29</span></a>
</span><span id="NodeHandle-30"><a href="#NodeHandle-30"><span class="linenos"> 30</span></a><span class="sd">    This class handles:</span>
</span><span id="NodeHandle-31"><a href="#NodeHandle-31"><span class="linenos"> 31</span></a><span class="sd">    - Registration with a graph service to obtain neighbor information.</span>
</span><span id="NodeHandle-32"><a href="#NodeHandle-32"><span class="linenos"> 32</span></a><span class="sd">    - Establishing ZeroMQ sockets for communication with neighbors.</span>
</span><span id="NodeHandle-33"><a href="#NodeHandle-33"><span class="linenos"> 33</span></a><span class="sd">    - Sending and receiving state information to/from neighbors.</span>
</span><span id="NodeHandle-34"><a href="#NodeHandle-34"><span class="linenos"> 34</span></a><span class="sd">    - Performing operations like exchanging states, computing Laplacians, and weighted mixing.</span>
</span><span id="NodeHandle-35"><a href="#NodeHandle-35"><span class="linenos"> 35</span></a>
</span><span id="NodeHandle-36"><a href="#NodeHandle-36"><span class="linenos"> 36</span></a><span class="sd">    Parameters</span>
</span><span id="NodeHandle-37"><a href="#NodeHandle-37"><span class="linenos"> 37</span></a><span class="sd">    ----------</span>
</span><span id="NodeHandle-38"><a href="#NodeHandle-38"><span class="linenos"> 38</span></a><span class="sd">    idx : str</span>
</span><span id="NodeHandle-39"><a href="#NodeHandle-39"><span class="linenos"> 39</span></a><span class="sd">        The index of the node within the graph.</span>
</span><span id="NodeHandle-40"><a href="#NodeHandle-40"><span class="linenos"> 40</span></a>
</span><span id="NodeHandle-41"><a href="#NodeHandle-41"><span class="linenos"> 41</span></a><span class="sd">    graph_name : str, optional</span>
</span><span id="NodeHandle-42"><a href="#NodeHandle-42"><span class="linenos"> 42</span></a><span class="sd">        Name of the graph to connect to (default is &quot;default&quot;). This should match the name used during graph creation.</span>
</span><span id="NodeHandle-43"><a href="#NodeHandle-43"><span class="linenos"> 43</span></a>
</span><span id="NodeHandle-44"><a href="#NodeHandle-44"><span class="linenos"> 44</span></a><span class="sd">    mask : Callable[[NDArray[float64]], NDArray[np.number]], optional</span>
</span><span id="NodeHandle-45"><a href="#NodeHandle-45"><span class="linenos"> 45</span></a><span class="sd">        A function to apply to the state before sending it to neighbors (default is identity function).</span>
</span><span id="NodeHandle-46"><a href="#NodeHandle-46"><span class="linenos"> 46</span></a><span class="sd">        This can be used to add noise, apply privacy mechanisms, or modify the state in other ways.</span>
</span><span id="NodeHandle-47"><a href="#NodeHandle-47"><span class="linenos"> 47</span></a>
</span><span id="NodeHandle-48"><a href="#NodeHandle-48"><span class="linenos"> 48</span></a><span class="sd">    Attributes</span>
</span><span id="NodeHandle-49"><a href="#NodeHandle-49"><span class="linenos"> 49</span></a><span class="sd">    ----------</span>
</span><span id="NodeHandle-50"><a href="#NodeHandle-50"><span class="linenos"> 50</span></a><span class="sd">    idx : str</span>
</span><span id="NodeHandle-51"><a href="#NodeHandle-51"><span class="linenos"> 51</span></a><span class="sd">        The index of the node within the graph.</span>
</span><span id="NodeHandle-52"><a href="#NodeHandle-52"><span class="linenos"> 52</span></a>
</span><span id="NodeHandle-53"><a href="#NodeHandle-53"><span class="linenos"> 53</span></a><span class="sd">    degree : int</span>
</span><span id="NodeHandle-54"><a href="#NodeHandle-54"><span class="linenos"> 54</span></a><span class="sd">        The number of neighbors connected to this node.</span>
</span><span id="NodeHandle-55"><a href="#NodeHandle-55"><span class="linenos"> 55</span></a>
</span><span id="NodeHandle-56"><a href="#NodeHandle-56"><span class="linenos"> 56</span></a><span class="sd">    neighbors : KeysView[str]</span>
</span><span id="NodeHandle-57"><a href="#NodeHandle-57"><span class="linenos"> 57</span></a><span class="sd">        A view of the names of the neighbor nodes.</span>
</span><span id="NodeHandle-58"><a href="#NodeHandle-58"><span class="linenos"> 58</span></a>
</span><span id="NodeHandle-59"><a href="#NodeHandle-59"><span class="linenos"> 59</span></a><span class="sd">    weights : dict[str, float]</span>
</span><span id="NodeHandle-60"><a href="#NodeHandle-60"><span class="linenos"> 60</span></a><span class="sd">        A dictionary mapping neighbor names to their corresponding weights.</span>
</span><span id="NodeHandle-61"><a href="#NodeHandle-61"><span class="linenos"> 61</span></a>
</span><span id="NodeHandle-62"><a href="#NodeHandle-62"><span class="linenos"> 62</span></a><span class="sd">    Notes</span>
</span><span id="NodeHandle-63"><a href="#NodeHandle-63"><span class="linenos"> 63</span></a><span class="sd">    -----</span>
</span><span id="NodeHandle-64"><a href="#NodeHandle-64"><span class="linenos"> 64</span></a><span class="sd">    - Throughout the code, we use &#39;i&#39; to denote the current node and &#39;j&#39; to denote neighbor nodes,</span>
</span><span id="NodeHandle-65"><a href="#NodeHandle-65"><span class="linenos"> 65</span></a><span class="sd">      following common conventions in graph theory and distributed algorithms.</span>
</span><span id="NodeHandle-66"><a href="#NodeHandle-66"><span class="linenos"> 66</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="NodeHandle-67"><a href="#NodeHandle-67"><span class="linenos"> 67</span></a>
</span><span id="NodeHandle-68"><a href="#NodeHandle-68"><span class="linenos"> 68</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="NodeHandle-69"><a href="#NodeHandle-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NodeHandle-70"><a href="#NodeHandle-70"><span class="linenos"> 70</span></a>        <span class="n">idx</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="NodeHandle-71"><a href="#NodeHandle-71"><span class="linenos"> 71</span></a>        <span class="n">graph_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="NodeHandle-72"><a href="#NodeHandle-72"><span class="linenos"> 72</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">]]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
</span><span id="NodeHandle-73"><a href="#NodeHandle-73"><span class="linenos"> 73</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NodeHandle-74"><a href="#NodeHandle-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="n">idx</span>
</span><span id="NodeHandle-75"><a href="#NodeHandle-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_name</span> <span class="o">=</span> <span class="n">graph_name</span>
</span><span id="NodeHandle-76"><a href="#NodeHandle-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">=</span> <span class="n">mask</span>
</span><span id="NodeHandle-77"><a href="#NodeHandle-77"><span class="linenos"> 77</span></a>
</span><span id="NodeHandle-78"><a href="#NodeHandle-78"><span class="linenos"> 78</span></a>        <span class="n">endpoint</span> <span class="o">=</span> <span class="n">discover_graph</span><span class="p">(</span><span class="n">graph_name</span><span class="p">)</span>
</span><span id="NodeHandle-79"><a href="#NodeHandle-79"><span class="linenos"> 79</span></a>
</span><span id="NodeHandle-80"><a href="#NodeHandle-80"><span class="linenos"> 80</span></a>        <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NodeHandle-81"><a href="#NodeHandle-81"><span class="linenos"> 81</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Timeout: Node &#39;</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&#39; can&#39;t discover graph &#39;</span><span class="si">{</span><span class="n">graph_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="NodeHandle-82"><a href="#NodeHandle-82"><span class="linenos"> 82</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="NodeHandle-83"><a href="#NodeHandle-83"><span class="linenos"> 83</span></a>            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="NodeHandle-84"><a href="#NodeHandle-84"><span class="linenos"> 84</span></a>
</span><span id="NodeHandle-85"><a href="#NodeHandle-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_ip_addr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_port</span> <span class="o">=</span> <span class="n">endpoint</span>
</span><span id="NodeHandle-86"><a href="#NodeHandle-86"><span class="linenos"> 86</span></a>
</span><span id="NodeHandle-87"><a href="#NodeHandle-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="o">=</span> <span class="n">zmq</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
</span><span id="NodeHandle-88"><a href="#NodeHandle-88"><span class="linenos"> 88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">DEALER</span><span class="p">)</span>
</span><span id="NodeHandle-89"><a href="#NodeHandle-89"><span class="linenos"> 89</span></a>
</span><span id="NodeHandle-90"><a href="#NodeHandle-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_weight</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="NodeHandle-91"><a href="#NodeHandle-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_out_socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">ROUTER</span><span class="p">)</span>
</span><span id="NodeHandle-92"><a href="#NodeHandle-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ip_address</span> <span class="o">=</span> <span class="n">get_local_ip</span><span class="p">()</span>
</span><span id="NodeHandle-93"><a href="#NodeHandle-93"><span class="linenos"> 93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_socket</span><span class="o">.</span><span class="n">bind_to_random_port</span><span class="p">(</span><span class="s2">&quot;tcp://*&quot;</span><span class="p">)</span>
</span><span id="NodeHandle-94"><a href="#NodeHandle-94"><span class="linenos"> 94</span></a>
</span><span id="NodeHandle-95"><a href="#NodeHandle-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NeighborContext</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NodeHandle-96"><a href="#NodeHandle-96"><span class="linenos"> 96</span></a>
</span><span id="NodeHandle-97"><a href="#NodeHandle-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_register_to_graph</span><span class="p">()</span>
</span><span id="NodeHandle-98"><a href="#NodeHandle-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_neighbors</span><span class="p">()</span>
</span><span id="NodeHandle-99"><a href="#NodeHandle-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connect_to_neighbors</span><span class="p">()</span>
</span><span id="NodeHandle-100"><a href="#NodeHandle-100"><span class="linenos">100</span></a>
</span><span id="NodeHandle-101"><a href="#NodeHandle-101"><span class="linenos">101</span></a>        <span class="c1"># Cache neighbor indices as bytes for ZeroMQ communication.</span>
</span><span id="NodeHandle-102"><a href="#NodeHandle-102"><span class="linenos">102</span></a>        <span class="c1"># NOTE: Neighbor set is currently static.</span>
</span><span id="NodeHandle-103"><a href="#NodeHandle-103"><span class="linenos">103</span></a>        <span class="c1"># If dynamic neighbor updates are introduced, this cache must be refreshed.</span>
</span><span id="NodeHandle-104"><a href="#NodeHandle-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_idx_bytes</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="p">]</span>
</span><span id="NodeHandle-105"><a href="#NodeHandle-105"><span class="linenos">105</span></a>
</span><span id="NodeHandle-106"><a href="#NodeHandle-106"><span class="linenos">106</span></a>    <span class="nd">@property</span>
</span><span id="NodeHandle-107"><a href="#NodeHandle-107"><span class="linenos">107</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">idx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="NodeHandle-108"><a href="#NodeHandle-108"><span class="linenos">108</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span>
</span><span id="NodeHandle-109"><a href="#NodeHandle-109"><span class="linenos">109</span></a>
</span><span id="NodeHandle-110"><a href="#NodeHandle-110"><span class="linenos">110</span></a>    <span class="nd">@property</span>
</span><span id="NodeHandle-111"><a href="#NodeHandle-111"><span class="linenos">111</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">degree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="NodeHandle-112"><a href="#NodeHandle-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="p">)</span>
</span><span id="NodeHandle-113"><a href="#NodeHandle-113"><span class="linenos">113</span></a>
</span><span id="NodeHandle-114"><a href="#NodeHandle-114"><span class="linenos">114</span></a>    <span class="nd">@property</span>
</span><span id="NodeHandle-115"><a href="#NodeHandle-115"><span class="linenos">115</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeysView</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="NodeHandle-116"><a href="#NodeHandle-116"><span class="linenos">116</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="NodeHandle-117"><a href="#NodeHandle-117"><span class="linenos">117</span></a>
</span><span id="NodeHandle-118"><a href="#NodeHandle-118"><span class="linenos">118</span></a>    <span class="nd">@property</span>
</span><span id="NodeHandle-119"><a href="#NodeHandle-119"><span class="linenos">119</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="NodeHandle-120"><a href="#NodeHandle-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="n">nc</span><span class="o">.</span><span class="n">weight</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="NodeHandle-121"><a href="#NodeHandle-121"><span class="linenos">121</span></a>
</span><span id="NodeHandle-122"><a href="#NodeHandle-122"><span class="linenos">122</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NodeHandle&quot;</span><span class="p">:</span>
</span><span id="NodeHandle-123"><a href="#NodeHandle-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="NodeHandle-124"><a href="#NodeHandle-124"><span class="linenos">124</span></a>
</span><span id="NodeHandle-125"><a href="#NodeHandle-125"><span class="linenos">125</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NodeHandle-126"><a href="#NodeHandle-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="NodeHandle-127"><a href="#NodeHandle-127"><span class="linenos">127</span></a>
</span><span id="NodeHandle-128"><a href="#NodeHandle-128"><span class="linenos">128</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_register_to_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NodeHandle-129"><a href="#NodeHandle-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_reg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tcp://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_ip_addr</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NodeHandle-130"><a href="#NodeHandle-130"><span class="linenos">130</span></a>        <span class="n">idx_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="NodeHandle-131"><a href="#NodeHandle-131"><span class="linenos">131</span></a>        <span class="n">endpoint_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ip_address</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_port</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="NodeHandle-132"><a href="#NodeHandle-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_reg</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">([</span><span class="n">idx_bytes</span><span class="p">,</span> <span class="n">endpoint_bytes</span><span class="p">])</span>
</span><span id="NodeHandle-133"><a href="#NodeHandle-133"><span class="linenos">133</span></a>        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reg</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span><span id="NodeHandle-134"><a href="#NodeHandle-134"><span class="linenos">134</span></a>
</span><span id="NodeHandle-135"><a href="#NodeHandle-135"><span class="linenos">135</span></a>        <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;OK&quot;</span><span class="p">:</span>
</span><span id="NodeHandle-136"><a href="#NodeHandle-136"><span class="linenos">136</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_idx</span><span class="si">}</span><span class="s2">&#39; joined graph &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
</span><span id="NodeHandle-137"><a href="#NodeHandle-137"><span class="linenos">137</span></a>        <span class="k">elif</span> <span class="n">reply</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;Error: Undefined node&quot;</span><span class="p">:</span>
</span><span id="NodeHandle-138"><a href="#NodeHandle-138"><span class="linenos">138</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Undefined node &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_idx</span><span class="si">}</span><span class="s2">&#39; in graph &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="NodeHandle-139"><a href="#NodeHandle-139"><span class="linenos">139</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="NodeHandle-140"><a href="#NodeHandle-140"><span class="linenos">140</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="NodeHandle-141"><a href="#NodeHandle-141"><span class="linenos">141</span></a>        <span class="k">elif</span> <span class="n">reply</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;Error: Node replaced&quot;</span><span class="p">:</span>
</span><span id="NodeHandle-142"><a href="#NodeHandle-142"><span class="linenos">142</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Node &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_idx</span><span class="si">}</span><span class="s2">&#39; was replaced in graph &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="NodeHandle-143"><a href="#NodeHandle-143"><span class="linenos">143</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="NodeHandle-144"><a href="#NodeHandle-144"><span class="linenos">144</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="NodeHandle-145"><a href="#NodeHandle-145"><span class="linenos">145</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NodeHandle-146"><a href="#NodeHandle-146"><span class="linenos">146</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unexpected reply: </span><span class="si">{</span><span class="n">reply</span><span class="si">!r}</span><span class="s2">&quot;</span>
</span><span id="NodeHandle-147"><a href="#NodeHandle-147"><span class="linenos">147</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="NodeHandle-148"><a href="#NodeHandle-148"><span class="linenos">148</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="NodeHandle-149"><a href="#NodeHandle-149"><span class="linenos">149</span></a>
</span><span id="NodeHandle-150"><a href="#NodeHandle-150"><span class="linenos">150</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NodeHandle-151"><a href="#NodeHandle-151"><span class="linenos">151</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reg</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span><span id="NodeHandle-152"><a href="#NodeHandle-152"><span class="linenos">152</span></a>        <span class="n">neighbor_info_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NeighborInfo</span><span class="p">]</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span><span id="NodeHandle-153"><a href="#NodeHandle-153"><span class="linenos">153</span></a>
</span><span id="NodeHandle-154"><a href="#NodeHandle-154"><span class="linenos">154</span></a>        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">neighbor_info_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="NodeHandle-155"><a href="#NodeHandle-155"><span class="linenos">155</span></a>            <span class="n">in_socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">DEALER</span><span class="p">)</span>
</span><span id="NodeHandle-156"><a href="#NodeHandle-156"><span class="linenos">156</span></a>            <span class="n">nc</span> <span class="o">=</span> <span class="n">NeighborContext</span><span class="p">(</span><span class="n">in_socket</span><span class="o">=</span><span class="n">in_socket</span><span class="p">,</span> <span class="o">**</span><span class="n">info</span><span class="p">)</span>
</span><span id="NodeHandle-157"><a href="#NodeHandle-157"><span class="linenos">157</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">nc</span>
</span><span id="NodeHandle-158"><a href="#NodeHandle-158"><span class="linenos">158</span></a>
</span><span id="NodeHandle-159"><a href="#NodeHandle-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_weight</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">weight</span> <span class="k">for</span> <span class="n">nc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="NodeHandle-160"><a href="#NodeHandle-160"><span class="linenos">160</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_idx</span><span class="si">}</span><span class="s2">&#39; received neighbor info and set up sockets.&quot;</span><span class="p">)</span>
</span><span id="NodeHandle-161"><a href="#NodeHandle-161"><span class="linenos">161</span></a>
</span><span id="NodeHandle-162"><a href="#NodeHandle-162"><span class="linenos">162</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_connect_to_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NodeHandle-163"><a href="#NodeHandle-163"><span class="linenos">163</span></a>        <span class="k">for</span> <span class="n">nc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="NodeHandle-164"><a href="#NodeHandle-164"><span class="linenos">164</span></a>            <span class="n">nc</span><span class="o">.</span><span class="n">in_socket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">IDENTITY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="NodeHandle-165"><a href="#NodeHandle-165"><span class="linenos">165</span></a>            <span class="n">nc</span><span class="o">.</span><span class="n">in_socket</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tcp://</span><span class="si">{</span><span class="n">nc</span><span class="o">.</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NodeHandle-166"><a href="#NodeHandle-166"><span class="linenos">166</span></a>
</span><span id="NodeHandle-167"><a href="#NodeHandle-167"><span class="linenos">167</span></a>        <span class="k">for</span> <span class="n">nc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="NodeHandle-168"><a href="#NodeHandle-168"><span class="linenos">168</span></a>            <span class="n">nc</span><span class="o">.</span><span class="n">in_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="NodeHandle-169"><a href="#NodeHandle-169"><span class="linenos">169</span></a>
</span><span id="NodeHandle-170"><a href="#NodeHandle-170"><span class="linenos">170</span></a>        <span class="n">connected</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="NodeHandle-171"><a href="#NodeHandle-171"><span class="linenos">171</span></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">connected</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">:</span>
</span><span id="NodeHandle-172"><a href="#NodeHandle-172"><span class="linenos">172</span></a>            <span class="n">client_id</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_socket</span><span class="o">.</span><span class="n">recv_multipart</span><span class="p">()</span>
</span><span id="NodeHandle-173"><a href="#NodeHandle-173"><span class="linenos">173</span></a>            <span class="n">received_name</span> <span class="o">=</span> <span class="n">client_id</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span id="NodeHandle-174"><a href="#NodeHandle-174"><span class="linenos">174</span></a>            <span class="k">if</span> <span class="n">received_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="p">:</span>
</span><span id="NodeHandle-175"><a href="#NodeHandle-175"><span class="linenos">175</span></a>                <span class="n">connected</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">received_name</span><span class="p">)</span>
</span><span id="NodeHandle-176"><a href="#NodeHandle-176"><span class="linenos">176</span></a>
</span><span id="NodeHandle-177"><a href="#NodeHandle-177"><span class="linenos">177</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_idx</span><span class="si">}</span><span class="s2">&#39; connected to all neighbors.&quot;</span><span class="p">)</span>
</span><span id="NodeHandle-178"><a href="#NodeHandle-178"><span class="linenos">178</span></a>
</span><span id="NodeHandle-179"><a href="#NodeHandle-179"><span class="linenos">179</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NodeHandle-180"><a href="#NodeHandle-180"><span class="linenos">180</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NodeHandle-181"><a href="#NodeHandle-181"><span class="linenos">181</span></a><span class="sd">        Explicitly closes all sockets and terminates the ZeroMQ context.</span>
</span><span id="NodeHandle-182"><a href="#NodeHandle-182"><span class="linenos">182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NodeHandle-183"><a href="#NodeHandle-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_reg</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="NodeHandle-184"><a href="#NodeHandle-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_out_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="NodeHandle-185"><a href="#NodeHandle-185"><span class="linenos">185</span></a>        <span class="k">for</span> <span class="n">nc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="NodeHandle-186"><a href="#NodeHandle-186"><span class="linenos">186</span></a>            <span class="n">nc</span><span class="o">.</span><span class="n">in_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="NodeHandle-187"><a href="#NodeHandle-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">term</span><span class="p">()</span>
</span><span id="NodeHandle-188"><a href="#NodeHandle-188"><span class="linenos">188</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_idx</span><span class="si">}</span><span class="s2">&#39; closed all sockets.&quot;</span><span class="p">)</span>
</span><span id="NodeHandle-189"><a href="#NodeHandle-189"><span class="linenos">189</span></a>
</span><span id="NodeHandle-190"><a href="#NodeHandle-190"><span class="linenos">190</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">neighborwise_exchange</span><span class="p">(</span>
</span><span id="NodeHandle-191"><a href="#NodeHandle-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">state_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span>
</span><span id="NodeHandle-192"><a href="#NodeHandle-192"><span class="linenos">192</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
</span><span id="NodeHandle-193"><a href="#NodeHandle-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NodeHandle-194"><a href="#NodeHandle-194"><span class="linenos">194</span></a><span class="sd">        Exchanges the given state map with all neighbor nodes.</span>
</span><span id="NodeHandle-195"><a href="#NodeHandle-195"><span class="linenos">195</span></a>
</span><span id="NodeHandle-196"><a href="#NodeHandle-196"><span class="linenos">196</span></a><span class="sd">        This method broadcasts the state map to all neighbors and then gathers their states.</span>
</span><span id="NodeHandle-197"><a href="#NodeHandle-197"><span class="linenos">197</span></a>
</span><span id="NodeHandle-198"><a href="#NodeHandle-198"><span class="linenos">198</span></a><span class="sd">        Args:</span>
</span><span id="NodeHandle-199"><a href="#NodeHandle-199"><span class="linenos">199</span></a><span class="sd">            state_map (dict[str, NDArray[np.float64]]): The state map to exchange with neighbors.</span>
</span><span id="NodeHandle-200"><a href="#NodeHandle-200"><span class="linenos">200</span></a>
</span><span id="NodeHandle-201"><a href="#NodeHandle-201"><span class="linenos">201</span></a><span class="sd">        Returns:</span>
</span><span id="NodeHandle-202"><a href="#NodeHandle-202"><span class="linenos">202</span></a><span class="sd">            dict[str, NDArray[np.float64]]: A dictionary mapping neighbor names to their received state maps.</span>
</span><span id="NodeHandle-203"><a href="#NodeHandle-203"><span class="linenos">203</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NodeHandle-204"><a href="#NodeHandle-204"><span class="linenos">204</span></a>        <span class="k">if</span> <span class="n">state_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="NodeHandle-205"><a href="#NodeHandle-205"><span class="linenos">205</span></a>            <span class="n">missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">-</span> <span class="n">state_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="NodeHandle-206"><a href="#NodeHandle-206"><span class="linenos">206</span></a>            <span class="n">extra</span> <span class="o">=</span> <span class="n">state_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="NodeHandle-207"><a href="#NodeHandle-207"><span class="linenos">207</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;State dictionary keys do not match neighbor names. Missing: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">, Extra: </span><span class="si">{</span><span class="n">extra</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="NodeHandle-208"><a href="#NodeHandle-208"><span class="linenos">208</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="NodeHandle-209"><a href="#NodeHandle-209"><span class="linenos">209</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="NodeHandle-210"><a href="#NodeHandle-210"><span class="linenos">210</span></a>
</span><span id="NodeHandle-211"><a href="#NodeHandle-211"><span class="linenos">211</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="p">:</span>
</span><span id="NodeHandle-212"><a href="#NodeHandle-212"><span class="linenos">212</span></a>            <span class="n">state</span> <span class="o">=</span> <span class="n">state_map</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="NodeHandle-213"><a href="#NodeHandle-213"><span class="linenos">213</span></a>            <span class="n">masked_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
</span><span id="NodeHandle-214"><a href="#NodeHandle-214"><span class="linenos">214</span></a>            <span class="n">dtype_bytes</span> <span class="o">=</span> <span class="n">masked_state</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="NodeHandle-215"><a href="#NodeHandle-215"><span class="linenos">215</span></a>            <span class="n">msgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">dtype_bytes</span><span class="p">,</span> <span class="n">masked_state</span><span class="p">]</span>
</span><span id="NodeHandle-216"><a href="#NodeHandle-216"><span class="linenos">216</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_out_socket</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">(</span><span class="n">msgs</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="NodeHandle-217"><a href="#NodeHandle-217"><span class="linenos">217</span></a>
</span><span id="NodeHandle-218"><a href="#NodeHandle-218"><span class="linenos">218</span></a>        <span class="n">neighbor_states</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NodeHandle-219"><a href="#NodeHandle-219"><span class="linenos">219</span></a>        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="NodeHandle-220"><a href="#NodeHandle-220"><span class="linenos">220</span></a>            <span class="n">_dtype_bytes</span><span class="p">,</span> <span class="n">state_bytes</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">in_socket</span><span class="o">.</span><span class="n">recv_multipart</span><span class="p">()</span>
</span><span id="NodeHandle-221"><a href="#NodeHandle-221"><span class="linenos">221</span></a>            <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">_dtype_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span><span id="NodeHandle-222"><a href="#NodeHandle-222"><span class="linenos">222</span></a>            <span class="n">raw_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">state_bytes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="NodeHandle-223"><a href="#NodeHandle-223"><span class="linenos">223</span></a>            <span class="n">neighbor_states</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_state</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="NodeHandle-224"><a href="#NodeHandle-224"><span class="linenos">224</span></a>
</span><span id="NodeHandle-225"><a href="#NodeHandle-225"><span class="linenos">225</span></a>        <span class="k">return</span> <span class="n">neighbor_states</span>
</span><span id="NodeHandle-226"><a href="#NodeHandle-226"><span class="linenos">226</span></a>
</span><span id="NodeHandle-227"><a href="#NodeHandle-227"><span class="linenos">227</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exchange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
</span><span id="NodeHandle-228"><a href="#NodeHandle-228"><span class="linenos">228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NodeHandle-229"><a href="#NodeHandle-229"><span class="linenos">229</span></a><span class="sd">        Exchanges the given state with all neighbor nodes.</span>
</span><span id="NodeHandle-230"><a href="#NodeHandle-230"><span class="linenos">230</span></a>
</span><span id="NodeHandle-231"><a href="#NodeHandle-231"><span class="linenos">231</span></a><span class="sd">        This method broadcasts the state to all neighbors and then gathers their states.</span>
</span><span id="NodeHandle-232"><a href="#NodeHandle-232"><span class="linenos">232</span></a>
</span><span id="NodeHandle-233"><a href="#NodeHandle-233"><span class="linenos">233</span></a><span class="sd">        Args:</span>
</span><span id="NodeHandle-234"><a href="#NodeHandle-234"><span class="linenos">234</span></a><span class="sd">            state (NDArray[np.float64]): The state array to exchange with neighbors.</span>
</span><span id="NodeHandle-235"><a href="#NodeHandle-235"><span class="linenos">235</span></a>
</span><span id="NodeHandle-236"><a href="#NodeHandle-236"><span class="linenos">236</span></a><span class="sd">        Returns:</span>
</span><span id="NodeHandle-237"><a href="#NodeHandle-237"><span class="linenos">237</span></a><span class="sd">            dict[str, NDArray[np.float64]]: A dictionary mapping neighbor names to their received state arrays.</span>
</span><span id="NodeHandle-238"><a href="#NodeHandle-238"><span class="linenos">238</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NodeHandle-239"><a href="#NodeHandle-239"><span class="linenos">239</span></a>        <span class="n">masked_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
</span><span id="NodeHandle-240"><a href="#NodeHandle-240"><span class="linenos">240</span></a>        <span class="n">dtype_bytes</span> <span class="o">=</span> <span class="n">masked_state</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="NodeHandle-241"><a href="#NodeHandle-241"><span class="linenos">241</span></a>        <span class="k">for</span> <span class="n">j_bytes</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_idx_bytes</span><span class="p">:</span>
</span><span id="NodeHandle-242"><a href="#NodeHandle-242"><span class="linenos">242</span></a>            <span class="n">msgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">j_bytes</span><span class="p">,</span> <span class="n">dtype_bytes</span><span class="p">,</span> <span class="n">masked_state</span><span class="p">]</span>
</span><span id="NodeHandle-243"><a href="#NodeHandle-243"><span class="linenos">243</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_out_socket</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">(</span><span class="n">msgs</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="NodeHandle-244"><a href="#NodeHandle-244"><span class="linenos">244</span></a>
</span><span id="NodeHandle-245"><a href="#NodeHandle-245"><span class="linenos">245</span></a>        <span class="n">neighbor_states</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NodeHandle-246"><a href="#NodeHandle-246"><span class="linenos">246</span></a>        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="NodeHandle-247"><a href="#NodeHandle-247"><span class="linenos">247</span></a>            <span class="n">_dtype_bytes</span><span class="p">,</span> <span class="n">state_bytes</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">in_socket</span><span class="o">.</span><span class="n">recv_multipart</span><span class="p">()</span>
</span><span id="NodeHandle-248"><a href="#NodeHandle-248"><span class="linenos">248</span></a>            <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">_dtype_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span><span id="NodeHandle-249"><a href="#NodeHandle-249"><span class="linenos">249</span></a>            <span class="n">raw_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">state_bytes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="NodeHandle-250"><a href="#NodeHandle-250"><span class="linenos">250</span></a>            <span class="n">neighbor_states</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_state</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="NodeHandle-251"><a href="#NodeHandle-251"><span class="linenos">251</span></a>
</span><span id="NodeHandle-252"><a href="#NodeHandle-252"><span class="linenos">252</span></a>        <span class="k">return</span> <span class="n">neighbor_states</span>
</span><span id="NodeHandle-253"><a href="#NodeHandle-253"><span class="linenos">253</span></a>
</span><span id="NodeHandle-254"><a href="#NodeHandle-254"><span class="linenos">254</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exchange_as_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
</span><span id="NodeHandle-255"><a href="#NodeHandle-255"><span class="linenos">255</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NodeHandle-256"><a href="#NodeHandle-256"><span class="linenos">256</span></a><span class="sd">        Exchanges the given state with all neighbor nodes and returns their states as a stacked array.</span>
</span><span id="NodeHandle-257"><a href="#NodeHandle-257"><span class="linenos">257</span></a>
</span><span id="NodeHandle-258"><a href="#NodeHandle-258"><span class="linenos">258</span></a><span class="sd">        Note: Using this method will add an extra copy of the neighbor states in memory compared to the `exchange` method.</span>
</span><span id="NodeHandle-259"><a href="#NodeHandle-259"><span class="linenos">259</span></a><span class="sd">        This is because the states are first received as individual memory buffers and then stacked into a single array.</span>
</span><span id="NodeHandle-260"><a href="#NodeHandle-260"><span class="linenos">260</span></a>
</span><span id="NodeHandle-261"><a href="#NodeHandle-261"><span class="linenos">261</span></a><span class="sd">        Args:</span>
</span><span id="NodeHandle-262"><a href="#NodeHandle-262"><span class="linenos">262</span></a><span class="sd">            state (NDArray[np.float64]): The state array to exchange with neighbors.</span>
</span><span id="NodeHandle-263"><a href="#NodeHandle-263"><span class="linenos">263</span></a>
</span><span id="NodeHandle-264"><a href="#NodeHandle-264"><span class="linenos">264</span></a><span class="sd">        Returns:</span>
</span><span id="NodeHandle-265"><a href="#NodeHandle-265"><span class="linenos">265</span></a><span class="sd">            NDArray[np.float64]: A 2D array where each row corresponds to a neighbor&#39;s received state array.</span>
</span><span id="NodeHandle-266"><a href="#NodeHandle-266"><span class="linenos">266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NodeHandle-267"><a href="#NodeHandle-267"><span class="linenos">267</span></a>        <span class="n">masked_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
</span><span id="NodeHandle-268"><a href="#NodeHandle-268"><span class="linenos">268</span></a>        <span class="n">dtype_bytes</span> <span class="o">=</span> <span class="n">masked_state</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="NodeHandle-269"><a href="#NodeHandle-269"><span class="linenos">269</span></a>        <span class="k">for</span> <span class="n">j_bytes</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_idx_bytes</span><span class="p">:</span>
</span><span id="NodeHandle-270"><a href="#NodeHandle-270"><span class="linenos">270</span></a>            <span class="n">msgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">j_bytes</span><span class="p">,</span> <span class="n">dtype_bytes</span><span class="p">,</span> <span class="n">masked_state</span><span class="p">]</span>
</span><span id="NodeHandle-271"><a href="#NodeHandle-271"><span class="linenos">271</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_out_socket</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">(</span><span class="n">msgs</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="NodeHandle-272"><a href="#NodeHandle-272"><span class="linenos">272</span></a>
</span><span id="NodeHandle-273"><a href="#NodeHandle-273"><span class="linenos">273</span></a>        <span class="n">neighbor_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NodeHandle-274"><a href="#NodeHandle-274"><span class="linenos">274</span></a>        <span class="k">for</span> <span class="n">nc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="NodeHandle-275"><a href="#NodeHandle-275"><span class="linenos">275</span></a>            <span class="n">_dtype_bytes</span><span class="p">,</span> <span class="n">state_bytes</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">in_socket</span><span class="o">.</span><span class="n">recv_multipart</span><span class="p">()</span>
</span><span id="NodeHandle-276"><a href="#NodeHandle-276"><span class="linenos">276</span></a>            <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">_dtype_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span><span id="NodeHandle-277"><a href="#NodeHandle-277"><span class="linenos">277</span></a>            <span class="n">raw_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">state_bytes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="NodeHandle-278"><a href="#NodeHandle-278"><span class="linenos">278</span></a>            <span class="n">neighbor_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_state</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="NodeHandle-279"><a href="#NodeHandle-279"><span class="linenos">279</span></a>
</span><span id="NodeHandle-280"><a href="#NodeHandle-280"><span class="linenos">280</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">neighbor_states</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="NodeHandle-281"><a href="#NodeHandle-281"><span class="linenos">281</span></a>
</span><span id="NodeHandle-282"><a href="#NodeHandle-282"><span class="linenos">282</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">laplacian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
</span><span id="NodeHandle-283"><a href="#NodeHandle-283"><span class="linenos">283</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NodeHandle-284"><a href="#NodeHandle-284"><span class="linenos">284</span></a><span class="sd">        Computes the Laplacian of the given state vector based on the states of neighboring nodes.</span>
</span><span id="NodeHandle-285"><a href="#NodeHandle-285"><span class="linenos">285</span></a>
</span><span id="NodeHandle-286"><a href="#NodeHandle-286"><span class="linenos">286</span></a><span class="sd">        The Laplacian is calculated as:</span>
</span><span id="NodeHandle-287"><a href="#NodeHandle-287"><span class="linenos">287</span></a>
</span><span id="NodeHandle-288"><a href="#NodeHandle-288"><span class="linenos">288</span></a><span class="sd">            laplacian = state * number_of_neighbors - sum_of_neighbor_states</span>
</span><span id="NodeHandle-289"><a href="#NodeHandle-289"><span class="linenos">289</span></a>
</span><span id="NodeHandle-290"><a href="#NodeHandle-290"><span class="linenos">290</span></a><span class="sd">        Args:</span>
</span><span id="NodeHandle-291"><a href="#NodeHandle-291"><span class="linenos">291</span></a><span class="sd">            state (NDArray[float64]): The state vector of the current node.</span>
</span><span id="NodeHandle-292"><a href="#NodeHandle-292"><span class="linenos">292</span></a>
</span><span id="NodeHandle-293"><a href="#NodeHandle-293"><span class="linenos">293</span></a><span class="sd">        Returns:</span>
</span><span id="NodeHandle-294"><a href="#NodeHandle-294"><span class="linenos">294</span></a><span class="sd">            NDArray[float64]: The Laplacian vector representing the difference between the current state and the average state of its neighbors.</span>
</span><span id="NodeHandle-295"><a href="#NodeHandle-295"><span class="linenos">295</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NodeHandle-296"><a href="#NodeHandle-296"><span class="linenos">296</span></a>        <span class="n">neighbor_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="NodeHandle-297"><a href="#NodeHandle-297"><span class="linenos">297</span></a>        <span class="n">laplacian</span> <span class="o">=</span> <span class="n">state</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbor_states</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">neighbor_states</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="NodeHandle-298"><a href="#NodeHandle-298"><span class="linenos">298</span></a>
</span><span id="NodeHandle-299"><a href="#NodeHandle-299"><span class="linenos">299</span></a>        <span class="k">return</span> <span class="n">laplacian</span>
</span><span id="NodeHandle-300"><a href="#NodeHandle-300"><span class="linenos">300</span></a>
</span><span id="NodeHandle-301"><a href="#NodeHandle-301"><span class="linenos">301</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">weighted_mix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
</span><span id="NodeHandle-302"><a href="#NodeHandle-302"><span class="linenos">302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NodeHandle-303"><a href="#NodeHandle-303"><span class="linenos">303</span></a><span class="sd">        Performs the weighted mixing operation for distributed optimization using the weight matrix W.</span>
</span><span id="NodeHandle-304"><a href="#NodeHandle-304"><span class="linenos">304</span></a>
</span><span id="NodeHandle-305"><a href="#NodeHandle-305"><span class="linenos">305</span></a><span class="sd">        For a given node i, the mixed state is computed as the i-th row of Wx, where x is the stacked state vector of all nodes.</span>
</span><span id="NodeHandle-306"><a href="#NodeHandle-306"><span class="linenos">306</span></a><span class="sd">        If x_i is multi-dimensional, the operation is applied element-wise.</span>
</span><span id="NodeHandle-307"><a href="#NodeHandle-307"><span class="linenos">307</span></a><span class="sd">        Specifically:</span>
</span><span id="NodeHandle-308"><a href="#NodeHandle-308"><span class="linenos">308</span></a>
</span><span id="NodeHandle-309"><a href="#NodeHandle-309"><span class="linenos">309</span></a><span class="sd">            mixed_state = W_ii * state + sum_j(W_ij * neighbor_state_j)</span>
</span><span id="NodeHandle-310"><a href="#NodeHandle-310"><span class="linenos">310</span></a>
</span><span id="NodeHandle-311"><a href="#NodeHandle-311"><span class="linenos">311</span></a><span class="sd">        where W_ii is self._weight and W_ij are the weights in self._neighbor_weights.</span>
</span><span id="NodeHandle-312"><a href="#NodeHandle-312"><span class="linenos">312</span></a>
</span><span id="NodeHandle-313"><a href="#NodeHandle-313"><span class="linenos">313</span></a><span class="sd">        Args:</span>
</span><span id="NodeHandle-314"><a href="#NodeHandle-314"><span class="linenos">314</span></a><span class="sd">            state (NDArray[np.float64]): The current state vector of node i.</span>
</span><span id="NodeHandle-315"><a href="#NodeHandle-315"><span class="linenos">315</span></a>
</span><span id="NodeHandle-316"><a href="#NodeHandle-316"><span class="linenos">316</span></a><span class="sd">        Returns:</span>
</span><span id="NodeHandle-317"><a href="#NodeHandle-317"><span class="linenos">317</span></a><span class="sd">            NDArray[float64]: The mixed state vector corresponding to the i-th row of Wx.</span>
</span><span id="NodeHandle-318"><a href="#NodeHandle-318"><span class="linenos">318</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NodeHandle-319"><a href="#NodeHandle-319"><span class="linenos">319</span></a>        <span class="n">neighbor_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="NodeHandle-320"><a href="#NodeHandle-320"><span class="linenos">320</span></a>        <span class="n">nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span>
</span><span id="NodeHandle-321"><a href="#NodeHandle-321"><span class="linenos">321</span></a>        <span class="n">mixed_state</span> <span class="o">=</span> <span class="n">state</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weight</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="NodeHandle-322"><a href="#NodeHandle-322"><span class="linenos">322</span></a>            <span class="n">neighbor_state</span> <span class="o">*</span> <span class="n">nc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span>
</span><span id="NodeHandle-323"><a href="#NodeHandle-323"><span class="linenos">323</span></a>            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">neighbor_state</span> <span class="ow">in</span> <span class="n">neighbor_states</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="NodeHandle-324"><a href="#NodeHandle-324"><span class="linenos">324</span></a>        <span class="p">)</span>
</span><span id="NodeHandle-325"><a href="#NodeHandle-325"><span class="linenos">325</span></a>
</span><span id="NodeHandle-326"><a href="#NodeHandle-326"><span class="linenos">326</span></a>        <span class="k">return</span> <span class="n">mixed_state</span>
</span></pre></div>


            <div class="docstring"><p>NodeHandle manages communication and state exchange between a node and its neighbors in a distributed network.</p>

<p>This class handles:</p>

<ul>
<li>Registration with a graph service to obtain neighbor information.</li>
<li>Establishing ZeroMQ sockets for communication with neighbors.</li>
<li>Sending and receiving state information to/from neighbors.</li>
<li>Performing operations like exchanging states, computing Laplacians, and weighted mixing.</li>
</ul>

<h2 id="parameters">Parameters</h2>

<p>idx : str
    The index of the node within the graph.</p>

<p>graph_name : str, optional
    Name of the graph to connect to (default is "default"). This should match the name used during graph creation.</p>

<p>mask : Callable[[NDArray[float64]], NDArray[np.number]], optional
    A function to apply to the state before sending it to neighbors (default is identity function).
    This can be used to add noise, apply privacy mechanisms, or modify the state in other ways.</p>

<h2 id="attributes">Attributes</h2>

<p>idx : str
    The index of the node within the graph.</p>

<p>degree : int
    The number of neighbors connected to this node.</p>

<p>neighbors : KeysView[str]
    A view of the names of the neighbor nodes.</p>

<p>weights : dict[str, float]
    A dictionary mapping neighbor names to their corresponding weights.</p>

<h2 id="notes">Notes</h2>

<ul>
<li>Throughout the code, we use 'i' to denote the current node and 'j' to denote neighbor nodes,
following common conventions in graph theory and distributed algorithms.</li>
</ul>
</div>


                            <div id="NodeHandle.__init__" class="classattr">
                                        <input id="NodeHandle.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">NodeHandle</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">idx</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">graph_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span>,</span><span class="param">	<span class="n">mask</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">]]]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">NodeHandle</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;&gt;</span></span>)</span>

                <label class="view-source-button" for="NodeHandle.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NodeHandle.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NodeHandle.__init__-68"><a href="#NodeHandle.__init__-68"><span class="linenos"> 68</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="NodeHandle.__init__-69"><a href="#NodeHandle.__init__-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NodeHandle.__init__-70"><a href="#NodeHandle.__init__-70"><span class="linenos"> 70</span></a>        <span class="n">idx</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="NodeHandle.__init__-71"><a href="#NodeHandle.__init__-71"><span class="linenos"> 71</span></a>        <span class="n">graph_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="NodeHandle.__init__-72"><a href="#NodeHandle.__init__-72"><span class="linenos"> 72</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">]]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
</span><span id="NodeHandle.__init__-73"><a href="#NodeHandle.__init__-73"><span class="linenos"> 73</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NodeHandle.__init__-74"><a href="#NodeHandle.__init__-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="n">idx</span>
</span><span id="NodeHandle.__init__-75"><a href="#NodeHandle.__init__-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_name</span> <span class="o">=</span> <span class="n">graph_name</span>
</span><span id="NodeHandle.__init__-76"><a href="#NodeHandle.__init__-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">=</span> <span class="n">mask</span>
</span><span id="NodeHandle.__init__-77"><a href="#NodeHandle.__init__-77"><span class="linenos"> 77</span></a>
</span><span id="NodeHandle.__init__-78"><a href="#NodeHandle.__init__-78"><span class="linenos"> 78</span></a>        <span class="n">endpoint</span> <span class="o">=</span> <span class="n">discover_graph</span><span class="p">(</span><span class="n">graph_name</span><span class="p">)</span>
</span><span id="NodeHandle.__init__-79"><a href="#NodeHandle.__init__-79"><span class="linenos"> 79</span></a>
</span><span id="NodeHandle.__init__-80"><a href="#NodeHandle.__init__-80"><span class="linenos"> 80</span></a>        <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NodeHandle.__init__-81"><a href="#NodeHandle.__init__-81"><span class="linenos"> 81</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Timeout: Node &#39;</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&#39; can&#39;t discover graph &#39;</span><span class="si">{</span><span class="n">graph_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="NodeHandle.__init__-82"><a href="#NodeHandle.__init__-82"><span class="linenos"> 82</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="NodeHandle.__init__-83"><a href="#NodeHandle.__init__-83"><span class="linenos"> 83</span></a>            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="NodeHandle.__init__-84"><a href="#NodeHandle.__init__-84"><span class="linenos"> 84</span></a>
</span><span id="NodeHandle.__init__-85"><a href="#NodeHandle.__init__-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_ip_addr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_port</span> <span class="o">=</span> <span class="n">endpoint</span>
</span><span id="NodeHandle.__init__-86"><a href="#NodeHandle.__init__-86"><span class="linenos"> 86</span></a>
</span><span id="NodeHandle.__init__-87"><a href="#NodeHandle.__init__-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="o">=</span> <span class="n">zmq</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
</span><span id="NodeHandle.__init__-88"><a href="#NodeHandle.__init__-88"><span class="linenos"> 88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">DEALER</span><span class="p">)</span>
</span><span id="NodeHandle.__init__-89"><a href="#NodeHandle.__init__-89"><span class="linenos"> 89</span></a>
</span><span id="NodeHandle.__init__-90"><a href="#NodeHandle.__init__-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_weight</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="NodeHandle.__init__-91"><a href="#NodeHandle.__init__-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_out_socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">ROUTER</span><span class="p">)</span>
</span><span id="NodeHandle.__init__-92"><a href="#NodeHandle.__init__-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ip_address</span> <span class="o">=</span> <span class="n">get_local_ip</span><span class="p">()</span>
</span><span id="NodeHandle.__init__-93"><a href="#NodeHandle.__init__-93"><span class="linenos"> 93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_socket</span><span class="o">.</span><span class="n">bind_to_random_port</span><span class="p">(</span><span class="s2">&quot;tcp://*&quot;</span><span class="p">)</span>
</span><span id="NodeHandle.__init__-94"><a href="#NodeHandle.__init__-94"><span class="linenos"> 94</span></a>
</span><span id="NodeHandle.__init__-95"><a href="#NodeHandle.__init__-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NeighborContext</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NodeHandle.__init__-96"><a href="#NodeHandle.__init__-96"><span class="linenos"> 96</span></a>
</span><span id="NodeHandle.__init__-97"><a href="#NodeHandle.__init__-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_register_to_graph</span><span class="p">()</span>
</span><span id="NodeHandle.__init__-98"><a href="#NodeHandle.__init__-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_neighbors</span><span class="p">()</span>
</span><span id="NodeHandle.__init__-99"><a href="#NodeHandle.__init__-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connect_to_neighbors</span><span class="p">()</span>
</span><span id="NodeHandle.__init__-100"><a href="#NodeHandle.__init__-100"><span class="linenos">100</span></a>
</span><span id="NodeHandle.__init__-101"><a href="#NodeHandle.__init__-101"><span class="linenos">101</span></a>        <span class="c1"># Cache neighbor indices as bytes for ZeroMQ communication.</span>
</span><span id="NodeHandle.__init__-102"><a href="#NodeHandle.__init__-102"><span class="linenos">102</span></a>        <span class="c1"># NOTE: Neighbor set is currently static.</span>
</span><span id="NodeHandle.__init__-103"><a href="#NodeHandle.__init__-103"><span class="linenos">103</span></a>        <span class="c1"># If dynamic neighbor updates are introduced, this cache must be refreshed.</span>
</span><span id="NodeHandle.__init__-104"><a href="#NodeHandle.__init__-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_idx_bytes</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="NodeHandle.idx" class="classattr">
                                        <input id="NodeHandle.idx-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">idx</span><span class="annotation">: str</span>

                <label class="view-source-button" for="NodeHandle.idx-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NodeHandle.idx"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NodeHandle.idx-106"><a href="#NodeHandle.idx-106"><span class="linenos">106</span></a>    <span class="nd">@property</span>
</span><span id="NodeHandle.idx-107"><a href="#NodeHandle.idx-107"><span class="linenos">107</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">idx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="NodeHandle.idx-108"><a href="#NodeHandle.idx-108"><span class="linenos">108</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span>
</span></pre></div>


    

                            </div>
                            <div id="NodeHandle.degree" class="classattr">
                                        <input id="NodeHandle.degree-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">degree</span><span class="annotation">: int</span>

                <label class="view-source-button" for="NodeHandle.degree-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NodeHandle.degree"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NodeHandle.degree-110"><a href="#NodeHandle.degree-110"><span class="linenos">110</span></a>    <span class="nd">@property</span>
</span><span id="NodeHandle.degree-111"><a href="#NodeHandle.degree-111"><span class="linenos">111</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">degree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="NodeHandle.degree-112"><a href="#NodeHandle.degree-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="NodeHandle.neighbors" class="classattr">
                                        <input id="NodeHandle.neighbors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">neighbors</span><span class="annotation">: KeysView[str]</span>

                <label class="view-source-button" for="NodeHandle.neighbors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NodeHandle.neighbors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NodeHandle.neighbors-114"><a href="#NodeHandle.neighbors-114"><span class="linenos">114</span></a>    <span class="nd">@property</span>
</span><span id="NodeHandle.neighbors-115"><a href="#NodeHandle.neighbors-115"><span class="linenos">115</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeysView</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="NodeHandle.neighbors-116"><a href="#NodeHandle.neighbors-116"><span class="linenos">116</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="NodeHandle.weights" class="classattr">
                                        <input id="NodeHandle.weights-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">weights</span><span class="annotation">: dict[str, float]</span>

                <label class="view-source-button" for="NodeHandle.weights-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NodeHandle.weights"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NodeHandle.weights-118"><a href="#NodeHandle.weights-118"><span class="linenos">118</span></a>    <span class="nd">@property</span>
</span><span id="NodeHandle.weights-119"><a href="#NodeHandle.weights-119"><span class="linenos">119</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="NodeHandle.weights-120"><a href="#NodeHandle.weights-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="n">nc</span><span class="o">.</span><span class="n">weight</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span></pre></div>


    

                            </div>
                            <div id="NodeHandle.close" class="classattr">
                                        <input id="NodeHandle.close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="NodeHandle.close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NodeHandle.close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NodeHandle.close-179"><a href="#NodeHandle.close-179"><span class="linenos">179</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NodeHandle.close-180"><a href="#NodeHandle.close-180"><span class="linenos">180</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NodeHandle.close-181"><a href="#NodeHandle.close-181"><span class="linenos">181</span></a><span class="sd">        Explicitly closes all sockets and terminates the ZeroMQ context.</span>
</span><span id="NodeHandle.close-182"><a href="#NodeHandle.close-182"><span class="linenos">182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NodeHandle.close-183"><a href="#NodeHandle.close-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_reg</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="NodeHandle.close-184"><a href="#NodeHandle.close-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_out_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="NodeHandle.close-185"><a href="#NodeHandle.close-185"><span class="linenos">185</span></a>        <span class="k">for</span> <span class="n">nc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="NodeHandle.close-186"><a href="#NodeHandle.close-186"><span class="linenos">186</span></a>            <span class="n">nc</span><span class="o">.</span><span class="n">in_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="NodeHandle.close-187"><a href="#NodeHandle.close-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">term</span><span class="p">()</span>
</span><span id="NodeHandle.close-188"><a href="#NodeHandle.close-188"><span class="linenos">188</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_idx</span><span class="si">}</span><span class="s2">&#39; closed all sockets.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Explicitly closes all sockets and terminates the ZeroMQ context.</p>
</div>


                            </div>
                            <div id="NodeHandle.neighborwise_exchange" class="classattr">
                                        <input id="NodeHandle.neighborwise_exchange-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">neighborwise_exchange</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">state_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]]]</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="NodeHandle.neighborwise_exchange-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NodeHandle.neighborwise_exchange"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NodeHandle.neighborwise_exchange-190"><a href="#NodeHandle.neighborwise_exchange-190"><span class="linenos">190</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">neighborwise_exchange</span><span class="p">(</span>
</span><span id="NodeHandle.neighborwise_exchange-191"><a href="#NodeHandle.neighborwise_exchange-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">state_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span>
</span><span id="NodeHandle.neighborwise_exchange-192"><a href="#NodeHandle.neighborwise_exchange-192"><span class="linenos">192</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
</span><span id="NodeHandle.neighborwise_exchange-193"><a href="#NodeHandle.neighborwise_exchange-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NodeHandle.neighborwise_exchange-194"><a href="#NodeHandle.neighborwise_exchange-194"><span class="linenos">194</span></a><span class="sd">        Exchanges the given state map with all neighbor nodes.</span>
</span><span id="NodeHandle.neighborwise_exchange-195"><a href="#NodeHandle.neighborwise_exchange-195"><span class="linenos">195</span></a>
</span><span id="NodeHandle.neighborwise_exchange-196"><a href="#NodeHandle.neighborwise_exchange-196"><span class="linenos">196</span></a><span class="sd">        This method broadcasts the state map to all neighbors and then gathers their states.</span>
</span><span id="NodeHandle.neighborwise_exchange-197"><a href="#NodeHandle.neighborwise_exchange-197"><span class="linenos">197</span></a>
</span><span id="NodeHandle.neighborwise_exchange-198"><a href="#NodeHandle.neighborwise_exchange-198"><span class="linenos">198</span></a><span class="sd">        Args:</span>
</span><span id="NodeHandle.neighborwise_exchange-199"><a href="#NodeHandle.neighborwise_exchange-199"><span class="linenos">199</span></a><span class="sd">            state_map (dict[str, NDArray[np.float64]]): The state map to exchange with neighbors.</span>
</span><span id="NodeHandle.neighborwise_exchange-200"><a href="#NodeHandle.neighborwise_exchange-200"><span class="linenos">200</span></a>
</span><span id="NodeHandle.neighborwise_exchange-201"><a href="#NodeHandle.neighborwise_exchange-201"><span class="linenos">201</span></a><span class="sd">        Returns:</span>
</span><span id="NodeHandle.neighborwise_exchange-202"><a href="#NodeHandle.neighborwise_exchange-202"><span class="linenos">202</span></a><span class="sd">            dict[str, NDArray[np.float64]]: A dictionary mapping neighbor names to their received state maps.</span>
</span><span id="NodeHandle.neighborwise_exchange-203"><a href="#NodeHandle.neighborwise_exchange-203"><span class="linenos">203</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NodeHandle.neighborwise_exchange-204"><a href="#NodeHandle.neighborwise_exchange-204"><span class="linenos">204</span></a>        <span class="k">if</span> <span class="n">state_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="NodeHandle.neighborwise_exchange-205"><a href="#NodeHandle.neighborwise_exchange-205"><span class="linenos">205</span></a>            <span class="n">missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">-</span> <span class="n">state_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="NodeHandle.neighborwise_exchange-206"><a href="#NodeHandle.neighborwise_exchange-206"><span class="linenos">206</span></a>            <span class="n">extra</span> <span class="o">=</span> <span class="n">state_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="NodeHandle.neighborwise_exchange-207"><a href="#NodeHandle.neighborwise_exchange-207"><span class="linenos">207</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;State dictionary keys do not match neighbor names. Missing: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">, Extra: </span><span class="si">{</span><span class="n">extra</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="NodeHandle.neighborwise_exchange-208"><a href="#NodeHandle.neighborwise_exchange-208"><span class="linenos">208</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="NodeHandle.neighborwise_exchange-209"><a href="#NodeHandle.neighborwise_exchange-209"><span class="linenos">209</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="NodeHandle.neighborwise_exchange-210"><a href="#NodeHandle.neighborwise_exchange-210"><span class="linenos">210</span></a>
</span><span id="NodeHandle.neighborwise_exchange-211"><a href="#NodeHandle.neighborwise_exchange-211"><span class="linenos">211</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="p">:</span>
</span><span id="NodeHandle.neighborwise_exchange-212"><a href="#NodeHandle.neighborwise_exchange-212"><span class="linenos">212</span></a>            <span class="n">state</span> <span class="o">=</span> <span class="n">state_map</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="NodeHandle.neighborwise_exchange-213"><a href="#NodeHandle.neighborwise_exchange-213"><span class="linenos">213</span></a>            <span class="n">masked_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
</span><span id="NodeHandle.neighborwise_exchange-214"><a href="#NodeHandle.neighborwise_exchange-214"><span class="linenos">214</span></a>            <span class="n">dtype_bytes</span> <span class="o">=</span> <span class="n">masked_state</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="NodeHandle.neighborwise_exchange-215"><a href="#NodeHandle.neighborwise_exchange-215"><span class="linenos">215</span></a>            <span class="n">msgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">dtype_bytes</span><span class="p">,</span> <span class="n">masked_state</span><span class="p">]</span>
</span><span id="NodeHandle.neighborwise_exchange-216"><a href="#NodeHandle.neighborwise_exchange-216"><span class="linenos">216</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_out_socket</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">(</span><span class="n">msgs</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="NodeHandle.neighborwise_exchange-217"><a href="#NodeHandle.neighborwise_exchange-217"><span class="linenos">217</span></a>
</span><span id="NodeHandle.neighborwise_exchange-218"><a href="#NodeHandle.neighborwise_exchange-218"><span class="linenos">218</span></a>        <span class="n">neighbor_states</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NodeHandle.neighborwise_exchange-219"><a href="#NodeHandle.neighborwise_exchange-219"><span class="linenos">219</span></a>        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="NodeHandle.neighborwise_exchange-220"><a href="#NodeHandle.neighborwise_exchange-220"><span class="linenos">220</span></a>            <span class="n">_dtype_bytes</span><span class="p">,</span> <span class="n">state_bytes</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">in_socket</span><span class="o">.</span><span class="n">recv_multipart</span><span class="p">()</span>
</span><span id="NodeHandle.neighborwise_exchange-221"><a href="#NodeHandle.neighborwise_exchange-221"><span class="linenos">221</span></a>            <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">_dtype_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span><span id="NodeHandle.neighborwise_exchange-222"><a href="#NodeHandle.neighborwise_exchange-222"><span class="linenos">222</span></a>            <span class="n">raw_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">state_bytes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="NodeHandle.neighborwise_exchange-223"><a href="#NodeHandle.neighborwise_exchange-223"><span class="linenos">223</span></a>            <span class="n">neighbor_states</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_state</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="NodeHandle.neighborwise_exchange-224"><a href="#NodeHandle.neighborwise_exchange-224"><span class="linenos">224</span></a>
</span><span id="NodeHandle.neighborwise_exchange-225"><a href="#NodeHandle.neighborwise_exchange-225"><span class="linenos">225</span></a>        <span class="k">return</span> <span class="n">neighbor_states</span>
</span></pre></div>


            <div class="docstring"><p>Exchanges the given state map with all neighbor nodes.</p>

<p>This method broadcasts the state map to all neighbors and then gathers their states.</p>

<p>Args:
    state_map (dict[str, NDArray[np.float64]]): The state map to exchange with neighbors.</p>

<p>Returns:
    dict[str, NDArray[np.float64]]: A dictionary mapping neighbor names to their received state maps.</p>
</div>


                            </div>
                            <div id="NodeHandle.exchange" class="classattr">
                                        <input id="NodeHandle.exchange-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">exchange</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">state</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="NodeHandle.exchange-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NodeHandle.exchange"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NodeHandle.exchange-227"><a href="#NodeHandle.exchange-227"><span class="linenos">227</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exchange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
</span><span id="NodeHandle.exchange-228"><a href="#NodeHandle.exchange-228"><span class="linenos">228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NodeHandle.exchange-229"><a href="#NodeHandle.exchange-229"><span class="linenos">229</span></a><span class="sd">        Exchanges the given state with all neighbor nodes.</span>
</span><span id="NodeHandle.exchange-230"><a href="#NodeHandle.exchange-230"><span class="linenos">230</span></a>
</span><span id="NodeHandle.exchange-231"><a href="#NodeHandle.exchange-231"><span class="linenos">231</span></a><span class="sd">        This method broadcasts the state to all neighbors and then gathers their states.</span>
</span><span id="NodeHandle.exchange-232"><a href="#NodeHandle.exchange-232"><span class="linenos">232</span></a>
</span><span id="NodeHandle.exchange-233"><a href="#NodeHandle.exchange-233"><span class="linenos">233</span></a><span class="sd">        Args:</span>
</span><span id="NodeHandle.exchange-234"><a href="#NodeHandle.exchange-234"><span class="linenos">234</span></a><span class="sd">            state (NDArray[np.float64]): The state array to exchange with neighbors.</span>
</span><span id="NodeHandle.exchange-235"><a href="#NodeHandle.exchange-235"><span class="linenos">235</span></a>
</span><span id="NodeHandle.exchange-236"><a href="#NodeHandle.exchange-236"><span class="linenos">236</span></a><span class="sd">        Returns:</span>
</span><span id="NodeHandle.exchange-237"><a href="#NodeHandle.exchange-237"><span class="linenos">237</span></a><span class="sd">            dict[str, NDArray[np.float64]]: A dictionary mapping neighbor names to their received state arrays.</span>
</span><span id="NodeHandle.exchange-238"><a href="#NodeHandle.exchange-238"><span class="linenos">238</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NodeHandle.exchange-239"><a href="#NodeHandle.exchange-239"><span class="linenos">239</span></a>        <span class="n">masked_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
</span><span id="NodeHandle.exchange-240"><a href="#NodeHandle.exchange-240"><span class="linenos">240</span></a>        <span class="n">dtype_bytes</span> <span class="o">=</span> <span class="n">masked_state</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="NodeHandle.exchange-241"><a href="#NodeHandle.exchange-241"><span class="linenos">241</span></a>        <span class="k">for</span> <span class="n">j_bytes</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_idx_bytes</span><span class="p">:</span>
</span><span id="NodeHandle.exchange-242"><a href="#NodeHandle.exchange-242"><span class="linenos">242</span></a>            <span class="n">msgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">j_bytes</span><span class="p">,</span> <span class="n">dtype_bytes</span><span class="p">,</span> <span class="n">masked_state</span><span class="p">]</span>
</span><span id="NodeHandle.exchange-243"><a href="#NodeHandle.exchange-243"><span class="linenos">243</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_out_socket</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">(</span><span class="n">msgs</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="NodeHandle.exchange-244"><a href="#NodeHandle.exchange-244"><span class="linenos">244</span></a>
</span><span id="NodeHandle.exchange-245"><a href="#NodeHandle.exchange-245"><span class="linenos">245</span></a>        <span class="n">neighbor_states</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NodeHandle.exchange-246"><a href="#NodeHandle.exchange-246"><span class="linenos">246</span></a>        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="NodeHandle.exchange-247"><a href="#NodeHandle.exchange-247"><span class="linenos">247</span></a>            <span class="n">_dtype_bytes</span><span class="p">,</span> <span class="n">state_bytes</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">in_socket</span><span class="o">.</span><span class="n">recv_multipart</span><span class="p">()</span>
</span><span id="NodeHandle.exchange-248"><a href="#NodeHandle.exchange-248"><span class="linenos">248</span></a>            <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">_dtype_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span><span id="NodeHandle.exchange-249"><a href="#NodeHandle.exchange-249"><span class="linenos">249</span></a>            <span class="n">raw_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">state_bytes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="NodeHandle.exchange-250"><a href="#NodeHandle.exchange-250"><span class="linenos">250</span></a>            <span class="n">neighbor_states</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_state</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="NodeHandle.exchange-251"><a href="#NodeHandle.exchange-251"><span class="linenos">251</span></a>
</span><span id="NodeHandle.exchange-252"><a href="#NodeHandle.exchange-252"><span class="linenos">252</span></a>        <span class="k">return</span> <span class="n">neighbor_states</span>
</span></pre></div>


            <div class="docstring"><p>Exchanges the given state with all neighbor nodes.</p>

<p>This method broadcasts the state to all neighbors and then gathers their states.</p>

<p>Args:
    state (NDArray[np.float64]): The state array to exchange with neighbors.</p>

<p>Returns:
    dict[str, NDArray[np.float64]]: A dictionary mapping neighbor names to their received state arrays.</p>
</div>


                            </div>
                            <div id="NodeHandle.exchange_as_array" class="classattr">
                                        <input id="NodeHandle.exchange_as_array-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">exchange_as_array</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">state</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="NodeHandle.exchange_as_array-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NodeHandle.exchange_as_array"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NodeHandle.exchange_as_array-254"><a href="#NodeHandle.exchange_as_array-254"><span class="linenos">254</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exchange_as_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
</span><span id="NodeHandle.exchange_as_array-255"><a href="#NodeHandle.exchange_as_array-255"><span class="linenos">255</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NodeHandle.exchange_as_array-256"><a href="#NodeHandle.exchange_as_array-256"><span class="linenos">256</span></a><span class="sd">        Exchanges the given state with all neighbor nodes and returns their states as a stacked array.</span>
</span><span id="NodeHandle.exchange_as_array-257"><a href="#NodeHandle.exchange_as_array-257"><span class="linenos">257</span></a>
</span><span id="NodeHandle.exchange_as_array-258"><a href="#NodeHandle.exchange_as_array-258"><span class="linenos">258</span></a><span class="sd">        Note: Using this method will add an extra copy of the neighbor states in memory compared to the `exchange` method.</span>
</span><span id="NodeHandle.exchange_as_array-259"><a href="#NodeHandle.exchange_as_array-259"><span class="linenos">259</span></a><span class="sd">        This is because the states are first received as individual memory buffers and then stacked into a single array.</span>
</span><span id="NodeHandle.exchange_as_array-260"><a href="#NodeHandle.exchange_as_array-260"><span class="linenos">260</span></a>
</span><span id="NodeHandle.exchange_as_array-261"><a href="#NodeHandle.exchange_as_array-261"><span class="linenos">261</span></a><span class="sd">        Args:</span>
</span><span id="NodeHandle.exchange_as_array-262"><a href="#NodeHandle.exchange_as_array-262"><span class="linenos">262</span></a><span class="sd">            state (NDArray[np.float64]): The state array to exchange with neighbors.</span>
</span><span id="NodeHandle.exchange_as_array-263"><a href="#NodeHandle.exchange_as_array-263"><span class="linenos">263</span></a>
</span><span id="NodeHandle.exchange_as_array-264"><a href="#NodeHandle.exchange_as_array-264"><span class="linenos">264</span></a><span class="sd">        Returns:</span>
</span><span id="NodeHandle.exchange_as_array-265"><a href="#NodeHandle.exchange_as_array-265"><span class="linenos">265</span></a><span class="sd">            NDArray[np.float64]: A 2D array where each row corresponds to a neighbor&#39;s received state array.</span>
</span><span id="NodeHandle.exchange_as_array-266"><a href="#NodeHandle.exchange_as_array-266"><span class="linenos">266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NodeHandle.exchange_as_array-267"><a href="#NodeHandle.exchange_as_array-267"><span class="linenos">267</span></a>        <span class="n">masked_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
</span><span id="NodeHandle.exchange_as_array-268"><a href="#NodeHandle.exchange_as_array-268"><span class="linenos">268</span></a>        <span class="n">dtype_bytes</span> <span class="o">=</span> <span class="n">masked_state</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="NodeHandle.exchange_as_array-269"><a href="#NodeHandle.exchange_as_array-269"><span class="linenos">269</span></a>        <span class="k">for</span> <span class="n">j_bytes</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_idx_bytes</span><span class="p">:</span>
</span><span id="NodeHandle.exchange_as_array-270"><a href="#NodeHandle.exchange_as_array-270"><span class="linenos">270</span></a>            <span class="n">msgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">j_bytes</span><span class="p">,</span> <span class="n">dtype_bytes</span><span class="p">,</span> <span class="n">masked_state</span><span class="p">]</span>
</span><span id="NodeHandle.exchange_as_array-271"><a href="#NodeHandle.exchange_as_array-271"><span class="linenos">271</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_out_socket</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">(</span><span class="n">msgs</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="NodeHandle.exchange_as_array-272"><a href="#NodeHandle.exchange_as_array-272"><span class="linenos">272</span></a>
</span><span id="NodeHandle.exchange_as_array-273"><a href="#NodeHandle.exchange_as_array-273"><span class="linenos">273</span></a>        <span class="n">neighbor_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NodeHandle.exchange_as_array-274"><a href="#NodeHandle.exchange_as_array-274"><span class="linenos">274</span></a>        <span class="k">for</span> <span class="n">nc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="NodeHandle.exchange_as_array-275"><a href="#NodeHandle.exchange_as_array-275"><span class="linenos">275</span></a>            <span class="n">_dtype_bytes</span><span class="p">,</span> <span class="n">state_bytes</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">in_socket</span><span class="o">.</span><span class="n">recv_multipart</span><span class="p">()</span>
</span><span id="NodeHandle.exchange_as_array-276"><a href="#NodeHandle.exchange_as_array-276"><span class="linenos">276</span></a>            <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">_dtype_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span><span id="NodeHandle.exchange_as_array-277"><a href="#NodeHandle.exchange_as_array-277"><span class="linenos">277</span></a>            <span class="n">raw_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">state_bytes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="NodeHandle.exchange_as_array-278"><a href="#NodeHandle.exchange_as_array-278"><span class="linenos">278</span></a>            <span class="n">neighbor_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_state</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="NodeHandle.exchange_as_array-279"><a href="#NodeHandle.exchange_as_array-279"><span class="linenos">279</span></a>
</span><span id="NodeHandle.exchange_as_array-280"><a href="#NodeHandle.exchange_as_array-280"><span class="linenos">280</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">neighbor_states</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Exchanges the given state with all neighbor nodes and returns their states as a stacked array.</p>

<p>Note: Using this method will add an extra copy of the neighbor states in memory compared to the <code><a href="#NodeHandle.exchange">exchange</a></code> method.
This is because the states are first received as individual memory buffers and then stacked into a single array.</p>

<p>Args:
    state (NDArray[np.float64]): The state array to exchange with neighbors.</p>

<p>Returns:
    NDArray[np.float64]: A 2D array where each row corresponds to a neighbor's received state array.</p>
</div>


                            </div>
                            <div id="NodeHandle.laplacian" class="classattr">
                                        <input id="NodeHandle.laplacian-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">laplacian</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">state</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="NodeHandle.laplacian-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NodeHandle.laplacian"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NodeHandle.laplacian-282"><a href="#NodeHandle.laplacian-282"><span class="linenos">282</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">laplacian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
</span><span id="NodeHandle.laplacian-283"><a href="#NodeHandle.laplacian-283"><span class="linenos">283</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NodeHandle.laplacian-284"><a href="#NodeHandle.laplacian-284"><span class="linenos">284</span></a><span class="sd">        Computes the Laplacian of the given state vector based on the states of neighboring nodes.</span>
</span><span id="NodeHandle.laplacian-285"><a href="#NodeHandle.laplacian-285"><span class="linenos">285</span></a>
</span><span id="NodeHandle.laplacian-286"><a href="#NodeHandle.laplacian-286"><span class="linenos">286</span></a><span class="sd">        The Laplacian is calculated as:</span>
</span><span id="NodeHandle.laplacian-287"><a href="#NodeHandle.laplacian-287"><span class="linenos">287</span></a>
</span><span id="NodeHandle.laplacian-288"><a href="#NodeHandle.laplacian-288"><span class="linenos">288</span></a><span class="sd">            laplacian = state * number_of_neighbors - sum_of_neighbor_states</span>
</span><span id="NodeHandle.laplacian-289"><a href="#NodeHandle.laplacian-289"><span class="linenos">289</span></a>
</span><span id="NodeHandle.laplacian-290"><a href="#NodeHandle.laplacian-290"><span class="linenos">290</span></a><span class="sd">        Args:</span>
</span><span id="NodeHandle.laplacian-291"><a href="#NodeHandle.laplacian-291"><span class="linenos">291</span></a><span class="sd">            state (NDArray[float64]): The state vector of the current node.</span>
</span><span id="NodeHandle.laplacian-292"><a href="#NodeHandle.laplacian-292"><span class="linenos">292</span></a>
</span><span id="NodeHandle.laplacian-293"><a href="#NodeHandle.laplacian-293"><span class="linenos">293</span></a><span class="sd">        Returns:</span>
</span><span id="NodeHandle.laplacian-294"><a href="#NodeHandle.laplacian-294"><span class="linenos">294</span></a><span class="sd">            NDArray[float64]: The Laplacian vector representing the difference between the current state and the average state of its neighbors.</span>
</span><span id="NodeHandle.laplacian-295"><a href="#NodeHandle.laplacian-295"><span class="linenos">295</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NodeHandle.laplacian-296"><a href="#NodeHandle.laplacian-296"><span class="linenos">296</span></a>        <span class="n">neighbor_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="NodeHandle.laplacian-297"><a href="#NodeHandle.laplacian-297"><span class="linenos">297</span></a>        <span class="n">laplacian</span> <span class="o">=</span> <span class="n">state</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbor_states</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">neighbor_states</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="NodeHandle.laplacian-298"><a href="#NodeHandle.laplacian-298"><span class="linenos">298</span></a>
</span><span id="NodeHandle.laplacian-299"><a href="#NodeHandle.laplacian-299"><span class="linenos">299</span></a>        <span class="k">return</span> <span class="n">laplacian</span>
</span></pre></div>


            <div class="docstring"><p>Computes the Laplacian of the given state vector based on the states of neighboring nodes.</p>

<p>The Laplacian is calculated as:</p>

<pre><code>laplacian = state * number_of_neighbors - sum_of_neighbor_states
</code></pre>

<p>Args:
    state (NDArray[float64]): The state vector of the current node.</p>

<p>Returns:
    NDArray[float64]: The Laplacian vector representing the difference between the current state and the average state of its neighbors.</p>
</div>


                            </div>
                            <div id="NodeHandle.weighted_mix" class="classattr">
                                        <input id="NodeHandle.weighted_mix-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">weighted_mix</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">state</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="NodeHandle.weighted_mix-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NodeHandle.weighted_mix"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NodeHandle.weighted_mix-301"><a href="#NodeHandle.weighted_mix-301"><span class="linenos">301</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">weighted_mix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
</span><span id="NodeHandle.weighted_mix-302"><a href="#NodeHandle.weighted_mix-302"><span class="linenos">302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NodeHandle.weighted_mix-303"><a href="#NodeHandle.weighted_mix-303"><span class="linenos">303</span></a><span class="sd">        Performs the weighted mixing operation for distributed optimization using the weight matrix W.</span>
</span><span id="NodeHandle.weighted_mix-304"><a href="#NodeHandle.weighted_mix-304"><span class="linenos">304</span></a>
</span><span id="NodeHandle.weighted_mix-305"><a href="#NodeHandle.weighted_mix-305"><span class="linenos">305</span></a><span class="sd">        For a given node i, the mixed state is computed as the i-th row of Wx, where x is the stacked state vector of all nodes.</span>
</span><span id="NodeHandle.weighted_mix-306"><a href="#NodeHandle.weighted_mix-306"><span class="linenos">306</span></a><span class="sd">        If x_i is multi-dimensional, the operation is applied element-wise.</span>
</span><span id="NodeHandle.weighted_mix-307"><a href="#NodeHandle.weighted_mix-307"><span class="linenos">307</span></a><span class="sd">        Specifically:</span>
</span><span id="NodeHandle.weighted_mix-308"><a href="#NodeHandle.weighted_mix-308"><span class="linenos">308</span></a>
</span><span id="NodeHandle.weighted_mix-309"><a href="#NodeHandle.weighted_mix-309"><span class="linenos">309</span></a><span class="sd">            mixed_state = W_ii * state + sum_j(W_ij * neighbor_state_j)</span>
</span><span id="NodeHandle.weighted_mix-310"><a href="#NodeHandle.weighted_mix-310"><span class="linenos">310</span></a>
</span><span id="NodeHandle.weighted_mix-311"><a href="#NodeHandle.weighted_mix-311"><span class="linenos">311</span></a><span class="sd">        where W_ii is self._weight and W_ij are the weights in self._neighbor_weights.</span>
</span><span id="NodeHandle.weighted_mix-312"><a href="#NodeHandle.weighted_mix-312"><span class="linenos">312</span></a>
</span><span id="NodeHandle.weighted_mix-313"><a href="#NodeHandle.weighted_mix-313"><span class="linenos">313</span></a><span class="sd">        Args:</span>
</span><span id="NodeHandle.weighted_mix-314"><a href="#NodeHandle.weighted_mix-314"><span class="linenos">314</span></a><span class="sd">            state (NDArray[np.float64]): The current state vector of node i.</span>
</span><span id="NodeHandle.weighted_mix-315"><a href="#NodeHandle.weighted_mix-315"><span class="linenos">315</span></a>
</span><span id="NodeHandle.weighted_mix-316"><a href="#NodeHandle.weighted_mix-316"><span class="linenos">316</span></a><span class="sd">        Returns:</span>
</span><span id="NodeHandle.weighted_mix-317"><a href="#NodeHandle.weighted_mix-317"><span class="linenos">317</span></a><span class="sd">            NDArray[float64]: The mixed state vector corresponding to the i-th row of Wx.</span>
</span><span id="NodeHandle.weighted_mix-318"><a href="#NodeHandle.weighted_mix-318"><span class="linenos">318</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NodeHandle.weighted_mix-319"><a href="#NodeHandle.weighted_mix-319"><span class="linenos">319</span></a>        <span class="n">neighbor_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="NodeHandle.weighted_mix-320"><a href="#NodeHandle.weighted_mix-320"><span class="linenos">320</span></a>        <span class="n">nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbor_contexts</span>
</span><span id="NodeHandle.weighted_mix-321"><a href="#NodeHandle.weighted_mix-321"><span class="linenos">321</span></a>        <span class="n">mixed_state</span> <span class="o">=</span> <span class="n">state</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weight</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="NodeHandle.weighted_mix-322"><a href="#NodeHandle.weighted_mix-322"><span class="linenos">322</span></a>            <span class="n">neighbor_state</span> <span class="o">*</span> <span class="n">nc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span>
</span><span id="NodeHandle.weighted_mix-323"><a href="#NodeHandle.weighted_mix-323"><span class="linenos">323</span></a>            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">neighbor_state</span> <span class="ow">in</span> <span class="n">neighbor_states</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="NodeHandle.weighted_mix-324"><a href="#NodeHandle.weighted_mix-324"><span class="linenos">324</span></a>        <span class="p">)</span>
</span><span id="NodeHandle.weighted_mix-325"><a href="#NodeHandle.weighted_mix-325"><span class="linenos">325</span></a>
</span><span id="NodeHandle.weighted_mix-326"><a href="#NodeHandle.weighted_mix-326"><span class="linenos">326</span></a>        <span class="k">return</span> <span class="n">mixed_state</span>
</span></pre></div>


            <div class="docstring"><p>Performs the weighted mixing operation for distributed optimization using the weight matrix W.</p>

<p>For a given node i, the mixed state is computed as the i-th row of Wx, where x is the stacked state vector of all nodes.
If x_i is multi-dimensional, the operation is applied element-wise.
Specifically:</p>

<pre><code>mixed_state = W_ii * state + sum_j(W_ij * neighbor_state_j)
</code></pre>

<p>where W_ii is self._weight and W_ij are the weights in self._neighbor_weights.</p>

<p>Args:
    state (NDArray[np.float64]): The current state vector of node i.</p>

<p>Returns:
    NDArray[float64]: The mixed state vector corresponding to the i-th row of Wx.</p>
</div>


                            </div>
                </section>
    </main>
</body>
</html>